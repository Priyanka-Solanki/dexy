<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="Asciidoctor 0.1.4" name="generator"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Dexy Developer Documentation</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
audio, canvas, video { display: inline-block; }
audio:not([controls]) { display: none; height: 0; }
[hidden] { display: none; }
html { background: #fff; color: #000; font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
a:focus { outline: thin dotted; }
a:active, a:hover { outline: 0; }
h1 { font-size: 2em; margin: 0.67em 0; }
abbr[title] { border-bottom: 1px dotted; }
b, strong { font-weight: bold; }
dfn { font-style: italic; }
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
mark { background: #ff0; color: #000; }
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
pre { white-space: pre-wrap; }
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
img { border: 0; }
svg:not(:root) { overflow: hidden; }
figure { margin: 0; }
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
legend { border: 0; padding: 0; }
button, input, select, textarea { font-family: inherit; font-size: 100%; margin: 0; }
button, input { line-height: normal; }
button, select { text-transform: none; }
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; cursor: pointer; }
button[disabled], html input[disabled] { cursor: default; }
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; padding: 0; }
input[type="search"] { -webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
textarea { overflow: auto; vertical-align: top; }
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #7a2518; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
a { color: #005498; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #00467f; }
a img { border: none; }
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Georgia, "URW Bookman L", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #6d180b; }
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }
ul, ol { margin-left: 1.5em; }
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }
blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: 0.9375em; padding: 1px 3px 0; white-space: nowrap; background-color: #f2f2f2; border: 1px solid #cccccc; -webkit-border-radius: 4px; border-radius: 4px; text-shadow: none; }
pre, pre > code { line-height: 1.4; color: inherit; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #555555; }
kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: #090909; }
p a > code:hover { color: #561309; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: black; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 3px double #ebebeb; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #7a2518; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #ebebeb; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #ebebeb; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }
#footer-text { color: #dddddd; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 3px double #ebebeb; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: none; border-width: 1px 0; border-style: dotted; border-color: #bfbfbf; -webkit-border-radius: 4px; border-radius: 4px; padding: 0.75em 0.75em 0.5em 0.75em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 1em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: inherit; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 4px; border-radius: 4px; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: #222222; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #00467f; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #005498; color: #003f72; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 0; border-radius: 0; }

</style>
<link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet"/>
<style>
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #ffffff; }
.highlight .tok-c { color: #888888 } /* Comment */
.highlight .tok-err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .tok-k { color: #008800; font-weight: bold } /* Keyword */
.highlight .tok-cm { color: #888888 } /* Comment.Multiline */
.highlight .tok-cp { color: #cc0000; font-weight: bold } /* Comment.Preproc */
.highlight .tok-c1 { color: #888888 } /* Comment.Single */
.highlight .tok-cs { color: #cc0000; font-weight: bold; background-color: #fff0f0 } /* Comment.Special */
.highlight .tok-gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .tok-ge { font-style: italic } /* Generic.Emph */
.highlight .tok-gr { color: #aa0000 } /* Generic.Error */
.highlight .tok-gh { color: #333333 } /* Generic.Heading */
.highlight .tok-gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .tok-go { color: #888888 } /* Generic.Output */
.highlight .tok-gp { color: #555555 } /* Generic.Prompt */
.highlight .tok-gs { font-weight: bold } /* Generic.Strong */
.highlight .tok-gu { color: #666666 } /* Generic.Subheading */
.highlight .tok-gt { color: #aa0000 } /* Generic.Traceback */
.highlight .tok-kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .tok-kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .tok-kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .tok-kp { color: #008800 } /* Keyword.Pseudo */
.highlight .tok-kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .tok-kt { color: #888888; font-weight: bold } /* Keyword.Type */
.highlight .tok-m { color: #0000DD; font-weight: bold } /* Literal.Number */
.highlight .tok-s { color: #dd2200; background-color: #fff0f0 } /* Literal.String */
.highlight .tok-na { color: #336699 } /* Name.Attribute */
.highlight .tok-nb { color: #003388 } /* Name.Builtin */
.highlight .tok-nc { color: #bb0066; font-weight: bold } /* Name.Class */
.highlight .tok-no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .tok-nd { color: #555555 } /* Name.Decorator */
.highlight .tok-ne { color: #bb0066; font-weight: bold } /* Name.Exception */
.highlight .tok-nf { color: #0066bb; font-weight: bold } /* Name.Function */
.highlight .tok-nl { color: #336699; font-style: italic } /* Name.Label */
.highlight .tok-nn { color: #bb0066; font-weight: bold } /* Name.Namespace */
.highlight .tok-py { color: #336699; font-weight: bold } /* Name.Property */
.highlight .tok-nt { color: #bb0066; font-weight: bold } /* Name.Tag */
.highlight .tok-nv { color: #336699 } /* Name.Variable */
.highlight .tok-ow { color: #008800 } /* Operator.Word */
.highlight .tok-w { color: #bbbbbb } /* Text.Whitespace */
.highlight .tok-mf { color: #0000DD; font-weight: bold } /* Literal.Number.Float */
.highlight .tok-mh { color: #0000DD; font-weight: bold } /* Literal.Number.Hex */
.highlight .tok-mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .tok-mo { color: #0000DD; font-weight: bold } /* Literal.Number.Oct */
.highlight .tok-sb { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .tok-sc { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Char */
.highlight .tok-sd { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Doc */
.highlight .tok-s2 { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Double */
.highlight .tok-se { color: #0044dd; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .tok-sh { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .tok-si { color: #3333bb; background-color: #fff0f0 } /* Literal.String.Interpol */
.highlight .tok-sx { color: #22bb22; background-color: #f0fff0 } /* Literal.String.Other */
.highlight .tok-sr { color: #008800; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .tok-s1 { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Single */
.highlight .tok-ss { color: #aa6600; background-color: #fff0f0 } /* Literal.String.Symbol */
.highlight .tok-bp { color: #003388 } /* Name.Builtin.Pseudo */
.highlight .tok-vc { color: #336699 } /* Name.Variable.Class */
.highlight .tok-vg { color: #dd7700 } /* Name.Variable.Global */
.highlight .tok-vi { color: #3333bb } /* Name.Variable.Instance */
.highlight .tok-il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
</style>
<script src="jquery.js" type="text/javascript"></script><script src="view-result.js" type="text/javascript"></script></head>
<body class="article toc2 toc-right">
<div id="header">
<h1>Dexy Developer Documentation</h1>
<div class="toc2" id="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_data_and_storage">Data and Storage</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_data_types">Data Types</a></li>
<li><a href="#_accessing_data_objects">Accessing Data Objects</a></li>
<li><a href="#_the_data_method">The data Method</a></li>
<li><a href="#_loading_and_reading_data">Loading and Reading Data</a></li>
<li><a href="#_string_like_access">String-Like Access</a></li>
<li><a href="#_dictionary_like_access">Dictionary-Like Access</a></li>
<li><a href="#_custom_access_methods">Custom Access Methods</a></li>
<li><a href="#_saving_data">Saving Data</a></li>
<li><a href="#_exporting_data">Exporting Data</a></li>
<li><a href="#_initializing_data_objects">Initializing Data Objects</a></li>
<li><a href="#_reconstituting_data_objects">Reconstituting Data Objects</a></li>
<li><a href="#_storage_objects">Storage Objects</a></li>
</ul>
</li>
<li><a href="#_filters">Filters</a></li>
<li><a href="#_wrapper_batches">Wrapper &amp; Batches</a></li>
<li><a href="#_parsers">Parsers</a></li>
<li><a href="#_reporters">Reporters</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_website_reporter">Website Reporter</a></li>
</ul>
</li>
<li><a href="#_templates">Templates</a></li>
<li><a href="#_command_line_interface">Command Line Interface</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_init_py">init.py</a></li>
<li><a href="#_cite_py">cite.py</a></li>
<li><a href="#_conf_py">conf.py</a></li>
<li><a href="#_dirs_py">dirs.py</a></li>
<li><a href="#_fcmds_py">fcmds.py</a></li>
<li><a href="#_filters_py">filters.py</a></li>
<li><a href="#_grep_py">grep.py</a></li>
<li><a href="#_info_py">info.py</a></li>
<li><a href="#_it_py">it.py</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is developer documentation for Dexy.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_and_storage">Data and Storage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Data objects capture the state of Dexy documents at a given stage in filter
processing, and Storage objects handle persistence of data objects. A Dexy
document will have a data object corresponding to its initial state (the
original file to be processed), plus a data object representing the state after
each filter is processed. Each data object has a corresponding storage object.
Filter implementations will call methods on data classes to append and save
data, and to read data from the previous stage in processing or other document
inputs.</p>
</div>
<div class="paragraph">
<p>For example, here’s the <code>process</code> method from the <code>ExampleProcessMethod</code> class,
which reads input from the <code>input_data</code> object, representing the previous data
state, and saving the modified data using the <code>set_data</code> method of the
<code>output_data</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">process</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-n">output</span> <span class="tok-o">=</span> <span class="tok-s">"Dexy processed the text '</span><span class="tok-si">%s</span><span class="tok-s">'"</span> <span class="tok-o">%</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">input_data</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">output_data</span><span class="tok-o">.</span><span class="tok-n">set_data</span><span class="tok-p">(</span><span class="tok-n">output</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Different data classes can expose methods which users and filters can access to
write or read data in useful ways, and different storage classes can implement
different storage options.</p>
</div>
<div class="sect2">
<h3 id="_data_types">Data Types</h3>
<div class="paragraph">
<p>The main role of data types is to provide convenient interfaces to the type of
data being stored.</p>
</div>
<div class="paragraph">
<p>The basic data class is <code>Generic</code> which is designed to store binary data or
unstructured text data. In this case the <code>_data</code> attribute contains the raw
binary data or text.</p>
</div>
<div class="paragraph">
<p><span class="icon"><a class="image" href="#"><i class="icon-shield" title="Test of Test Generic Data Stores String"></i></a></span></p>
</div>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">test_generic_data_stores_string</span><span class="tok-p">():</span>
    <span class="tok-k">with</span> <span class="tok-n">wrap</span><span class="tok-p">()</span> <span class="tok-k">as</span> <span class="tok-n">wrapper</span><span class="tok-p">:</span>
        <span class="tok-n">doc</span> <span class="tok-o">=</span> <span class="tok-n">Doc</span><span class="tok-p">(</span><span class="tok-s">"hello.txt"</span><span class="tok-p">,</span>
                <span class="tok-n">wrapper</span><span class="tok-p">,</span>
                <span class="tok-p">[],</span>
                <span class="tok-n">contents</span><span class="tok-o">=</span><span class="tok-s">"hello"</span>
                <span class="tok-p">)</span>

        <span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">run_docs</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">)</span>
        <span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">output_data</span><span class="tok-p">()</span>

        <span class="tok-k">assert</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">alias</span> <span class="tok-o">==</span> <span class="tok-s">'generic'</span>
        <span class="tok-k">assert</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">_data</span> <span class="tok-o">==</span> <span class="tok-s">"hello"</span>
</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The next class is <code>Sectioned</code> which holds ordered, named sections. These are
usually named sections in a document. When data is loaded in memory, the
<code>_data</code> attribute holds a list of dictionaries. The first entry contains
metadata for the document, the subsequent dictionaries contain each section’s
content and metadata.</p>
</div>
<div class="paragraph">
<p><span class="icon"><a class="image" href="#"><i class="icon-shield" title="Test of Test Sectioned Data Stores List Of Dicts"></i></a></span></p>
</div>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">test_sectioned_data_stores_list_of_dicts</span><span class="tok-p">():</span>
    <span class="tok-k">with</span> <span class="tok-n">wrap</span><span class="tok-p">()</span> <span class="tok-k">as</span> <span class="tok-n">wrapper</span><span class="tok-p">:</span>
        <span class="tok-n">contents</span><span class="tok-o">=</span><span class="tok-p">[</span>
                <span class="tok-p">{},</span>
                <span class="tok-p">{</span>
                    <span class="tok-s">"name"</span> <span class="tok-p">:</span> <span class="tok-s">"Welcome"</span><span class="tok-p">,</span>
                    <span class="tok-s">"contents"</span> <span class="tok-p">:</span> <span class="tok-s">"This is the first section."</span>
                <span class="tok-p">}</span>
            <span class="tok-p">]</span>

        <span class="tok-n">doc</span> <span class="tok-o">=</span> <span class="tok-n">Doc</span><span class="tok-p">(</span><span class="tok-s">"hello.txt"</span><span class="tok-p">,</span>
                <span class="tok-n">wrapper</span><span class="tok-p">,</span>
                <span class="tok-p">[],</span>
                <span class="tok-n">data_type</span><span class="tok-o">=</span><span class="tok-s">"sectioned"</span><span class="tok-p">,</span>
                <span class="tok-n">contents</span><span class="tok-o">=</span><span class="tok-n">contents</span>
                <span class="tok-p">)</span>

        <span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">run_docs</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">)</span>
        <span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">output_data</span><span class="tok-p">()</span>

        <span class="tok-k">assert</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">alias</span> <span class="tok-o">==</span> <span class="tok-s">'sectioned'</span>
        <span class="tok-k">assert</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">_data</span> <span class="tok-o">==</span> <span class="tok-n">contents</span>
        <span class="tok-k">assert</span> <span class="tok-n">data</span><span class="tok-p">[</span><span class="tok-s">'Welcome'</span><span class="tok-p">][</span><span class="tok-s">'contents'</span><span class="tok-p">]</span> <span class="tok-o">==</span> <span class="tok-s">"This is the first section."</span>
        <span class="tok-k">assert</span> <span class="tok-n">data</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">][</span><span class="tok-s">'contents'</span><span class="tok-p">]</span> <span class="tok-o">==</span> <span class="tok-s">"This is the first section."</span>
</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Another class is <code>KeyValue</code> which holds dictionary-type data. Unlike sectioned
data, there is no requirement for the entries to be kept in order, and there is
no arbitrary metadata for each section. There are several options for storage
including JSON data files and Sqlite databases.</p>
</div>
<div class="paragraph">
<p>The <code>KeyValue</code> type cannot be initialized with a dictionary. Instead an empty
data object needs to be initialized and then the <code>append</code> method must be used
to add keys and values. This ensures that the behavior of the data type is the
same whether the backend is a JSON file or a sqlite database.</p>
</div>
<div class="paragraph">
<p><span class="icon"><a class="image" href="#"><i class="icon-shield" title="Test of Test Keyvalue Data Stores Dict"></i></a></span></p>
</div>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">test_keyvalue_data_stores_dict</span><span class="tok-p">():</span>
    <span class="tok-k">with</span> <span class="tok-n">wrap</span><span class="tok-p">()</span> <span class="tok-k">as</span> <span class="tok-n">wrapper</span><span class="tok-p">:</span>
        <span class="tok-n">doc</span> <span class="tok-o">=</span> <span class="tok-n">Doc</span><span class="tok-p">(</span><span class="tok-s">"hello.json"</span><span class="tok-p">,</span>
                <span class="tok-n">wrapper</span><span class="tok-p">,</span>
                <span class="tok-p">[],</span>
                <span class="tok-n">data_type</span><span class="tok-o">=</span><span class="tok-s">"keyvalue"</span><span class="tok-p">,</span>
                <span class="tok-n">contents</span><span class="tok-o">=</span><span class="tok-s">"dummy contents"</span>
                <span class="tok-p">)</span>

        <span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">run_docs</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">)</span>
        <span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">output_data</span><span class="tok-p">()</span>

        <span class="tok-k">assert</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">alias</span> <span class="tok-o">==</span> <span class="tok-s">'keyvalue'</span>
        <span class="tok-k">assert</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">keys</span><span class="tok-p">()</span> <span class="tok-o">==</span> <span class="tok-p">[]</span>

        <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">append</span><span class="tok-p">(</span><span class="tok-s">"foo"</span><span class="tok-p">,</span> <span class="tok-mi">123</span><span class="tok-p">)</span>
        <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">append</span><span class="tok-p">(</span><span class="tok-s">"bar"</span><span class="tok-p">,</span> <span class="tok-mi">456</span><span class="tok-p">)</span>

        <span class="tok-k">assert</span> <span class="tok-nb">sorted</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">keys</span><span class="tok-p">())</span> <span class="tok-o">==</span> <span class="tok-p">[</span><span class="tok-s">"bar"</span><span class="tok-p">,</span> <span class="tok-s">"foo"</span><span class="tok-p">]</span>
</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Additional classes are available which are intended to provide custom
interfaces to data. For example the <code>BeautifulSoupData</code> type makes it easy to
apply the BeautifulSoup HTML parser to content, and so in documents you can run
queries using CSS selectors to extract a part of the document you are
interested in.</p>
</div>
<div class="paragraph">
<p>Creating a plugin with a custom data type is a possible alternative to writing
a filter. With a filter, the results of processing a whole document are cached.
With a custom data type, you can run code on just a piece of a document you are
interested in, but the results will not be cached, the calculation will be
re-run each time the template document is processed. Using custom data types
mean you put more logic in your template documents.</p>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_data_objects">Accessing Data Objects</h3>
<div class="paragraph">
<p>Within a filter, you can access the previous step’s output (this step’s input)
using the <code>input_data</code> attribute.</p>
</div>
<div class="paragraph">
<p>The filter output is stored in the <code>output_data</code> attribute.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_data_method">The data Method</h3>
<div class="paragraph">
<p>In some classes, you can directly access stored data via the <code>data()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">data</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">if</span> <span class="tok-p">(</span><span class="tok-ow">not</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span><span class="tok-p">)</span> <span class="tok-ow">or</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span> <span class="tok-o">==</span> <span class="tok-p">[{}]:</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">load_data</span><span class="tok-p">()</span>
        <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually you will not call <code>data()</code> directly but will call a method designed to
work with the stored data in a transparent way, like <code>str()</code>, <code>keys()</code>, or
<code>iter()</code>.</p>
</div>
<div class="paragraph">
<p>Different data types in Dexy will implement common methods such as <code>str()</code>,
<code>keys()</code> and <code>iter()</code> appropriately for the type of data they are wrapping.</p>
</div>
<div class="paragraph">
<p>Where it is meaningless to access the <code>data()</code> object, the method should raise
an Exception, as for the KeyValue data type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">data</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">raise</span> <span class="tok-ne">Exception</span><span class="tok-p">(</span><span class="tok-s">"No data method for KeyValue type data."</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_loading_and_reading_data">Loading and Reading Data</h3>
<div class="paragraph">
<p>Data will typically be loaded automatically when needed by calling the <code>data()</code>
method, directly or indirectly. Other methods which access data should do so
via the <code>data()</code> method. If necessary, the <code>data()</code> method calls the
<code>load_data()</code> method, which in turn calls the storage’s <code>read_data()</code> since
knowledge of where the data is stored and how to load it is the responsibility
of the Storage object.</p>
</div>
<div class="paragraph">
<p>Here’s the <code>load_data()</code> method from the base <code>Data</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">load_data</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">this</span><span class="tok-o">=</span><span class="tok-bp">None</span><span class="tok-p">):</span>
        <span class="tok-k">try</span><span class="tok-p">:</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">read_data</span><span class="tok-p">()</span>
        <span class="tok-k">except</span> <span class="tok-ne">IOError</span><span class="tok-p">:</span>
            <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"no data in file '</span><span class="tok-si">%s</span><span class="tok-s">' for </span><span class="tok-si">%s</span><span class="tok-s"> (wrapper state '</span><span class="tok-si">%s</span><span class="tok-s">', data state '</span><span class="tok-si">%s</span><span class="tok-s">')"</span>
            <span class="tok-n">msgargs</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">data_file</span><span class="tok-p">(),</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">,</span>
                    <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">state</span><span class="tok-p">,</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">state</span><span class="tok-p">)</span>
            <span class="tok-k">raise</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">InternalDexyProblem</span><span class="tok-p">(</span><span class="tok-n">msg</span> <span class="tok-o">%</span> <span class="tok-n">msgargs</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_string_like_access">String-Like Access</h3>
<div class="paragraph">
<p>Where it makes sense, the <code>__unicode__</code> method should return the contents of a
document as a unicode string.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">__unicode__</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">if</span> <span class="tok-nb">isinstance</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">(),</span> <span class="tok-nb">unicode</span><span class="tok-p">):</span>
            <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">()</span>
        <span class="tok-k">elif</span> <span class="tok-ow">not</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">():</span>
            <span class="tok-k">return</span> <span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-bp">None</span><span class="tok-p">)</span>
        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">decode_encoded</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">())</span>
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">__unicode__</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-s">u"</span><span class="tok-se">\n</span><span class="tok-s">"</span><span class="tok-o">.</span><span class="tok-n">join</span><span class="tok-p">(</span><span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">)</span> <span class="tok-k">for</span> <span class="tok-n">v</span> <span class="tok-ow">in</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">values</span><span class="tok-p">()</span> <span class="tok-k">if</span> <span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">))</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>str</code> method will convert results of <code>__unicode__</code> to an instance of <code>str</code>
type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">__str__</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">encode</span><span class="tok-p">(</span><span class="tok-s">"utf-8"</span><span class="tok-p">,</span> <span class="tok-n">errors</span><span class="tok-o">=</span><span class="tok-s">"strict"</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dictionary_like_access">Dictionary-Like Access</h3>
<div class="paragraph">
<p>Data types should support dictionary-style access where appropriate.</p>
</div>
<div class="paragraph">
<p>Although the <code>Generic</code> type does not have sections, it implements
dictionary-style access as though it consists of a single section with name
<code>"1"</code>. This way filters can be written which can process either <code>Generic</code> or
<code>Sectioned</code> data as input data.</p>
</div>
<div class="paragraph">
<p>TODO: Example of filter which makes use of Generic’s dummy sections. Pyg filter maybe?</p>
</div>
<div class="paragraph">
<p>The <code>iteritems</code> method should yield key, value tuples.</p>
</div>
<div class="paragraph">
<p>Generic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">iteritems</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-sd">"""</span>
<span class="tok-sd">        Iterable list of sections in document.</span>
<span class="tok-sd">        """</span>
        <span class="tok-k">yield</span> <span class="tok-p">(</span><span class="tok-s">'1'</span><span class="tok-p">,</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">())</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sectioned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">iteritems</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-sd">"""</span>
<span class="tok-sd">        Iterable list of sections in document.</span>
<span class="tok-sd">        """</span>
        <span class="tok-n">keys</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">keys</span><span class="tok-p">()</span>
        <span class="tok-n">values</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">values</span><span class="tok-p">()</span>
        <span class="tok-k">for</span> <span class="tok-n">i</span> <span class="tok-ow">in</span> <span class="tok-nb">range</span><span class="tok-p">(</span><span class="tok-nb">len</span><span class="tok-p">(</span><span class="tok-n">keys</span><span class="tok-p">)):</span>
            <span class="tok-k">yield</span> <span class="tok-p">(</span><span class="tok-n">keys</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">],</span> <span class="tok-n">values</span><span class="tok-p">[</span><span class="tok-n">i</span><span class="tok-p">])</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>KeyValue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">iteritems</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-sd">"""</span>
<span class="tok-sd">        Iterable list of available keys.</span>
<span class="tok-sd">        """</span>
        <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">iteritems</span><span class="tok-p">()</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sqlite3KeyValueStorage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">iteritems</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_cursor</span><span class="tok-o">.</span><span class="tok-n">execute</span><span class="tok-p">(</span><span class="tok-s">"SELECT key, value from kvstore"</span><span class="tok-p">)</span>
        <span class="tok-k">for</span> <span class="tok-n">k</span> <span class="tok-ow">in</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_cursor</span><span class="tok-o">.</span><span class="tok-n">fetchall</span><span class="tok-p">():</span>
            <span class="tok-k">yield</span> <span class="tok-p">(</span><span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">k</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]),</span> <span class="tok-n">k</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">])</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>JsonKeyValueStorage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">iteritems</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">()</span><span class="tok-o">.</span><span class="tok-n">iteritems</span><span class="tok-p">()</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>items</code> method should return a list of key, value tuples:</p>
</div>
<div class="paragraph">
<p>Generic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">items</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-sd">"""</span>
<span class="tok-sd">        List of sections in document.</span>
<span class="tok-sd">        """</span>
        <span class="tok-k">return</span> <span class="tok-p">[(</span><span class="tok-s">'1'</span><span class="tok-p">,</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">(),)]</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sectioned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">items</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-p">[(</span><span class="tok-n">key</span><span class="tok-p">,</span> <span class="tok-n">value</span><span class="tok-p">)</span> <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">,</span> <span class="tok-n">value</span><span class="tok-p">)</span> <span class="tok-ow">in</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">iteritems</span><span class="tok-p">()]</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>KeyValue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">items</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-sd">"""</span>
<span class="tok-sd">        List of available keys.</span>
<span class="tok-sd">        """</span>
        <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">items</span><span class="tok-p">()</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sqlite3KeyValueStorage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">items</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-p">[(</span><span class="tok-n">key</span><span class="tok-p">,</span> <span class="tok-n">value</span><span class="tok-p">)</span> <span class="tok-k">for</span> <span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">,</span> <span class="tok-n">value</span><span class="tok-p">)</span> <span class="tok-ow">in</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">iteritems</span><span class="tok-p">()]</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>JsonKeyValueStorage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">items</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">()</span><span class="tok-o">.</span><span class="tok-n">items</span><span class="tok-p">()</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>keys</code> method should return a list of keys:</p>
</div>
<div class="paragraph">
<p>Generic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">keys</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-sd">"""</span>
<span class="tok-sd">        List of keys (section names) in document.</span>
<span class="tok-sd">        """</span>
        <span class="tok-k">return</span> <span class="tok-p">[</span><span class="tok-s">'1'</span><span class="tok-p">]</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sectioned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">keys</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-p">[</span><span class="tok-n">a</span><span class="tok-p">[</span><span class="tok-s">'name'</span><span class="tok-p">]</span> <span class="tok-k">for</span> <span class="tok-n">a</span> <span class="tok-ow">in</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">()[</span><span class="tok-mi">1</span><span class="tok-p">:]]</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>KeyValue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">keys</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">keys</span><span class="tok-p">()</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sqlite3KeyValueStorage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">keys</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_cursor</span><span class="tok-o">.</span><span class="tok-n">execute</span><span class="tok-p">(</span><span class="tok-s">"SELECT key from kvstore"</span><span class="tok-p">)</span>
        <span class="tok-k">return</span> <span class="tok-p">[</span><span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">k</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">])</span> <span class="tok-k">for</span> <span class="tok-n">k</span> <span class="tok-ow">in</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_cursor</span><span class="tok-o">.</span><span class="tok-n">fetchall</span><span class="tok-p">()]</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>JsonKeyValueStorage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">keys</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">()</span><span class="tok-o">.</span><span class="tok-n">keys</span><span class="tok-p">()</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To allow accessing elements using the <code>[key]</code> syntax, the <code>__getitem__</code> method
is implemented:</p>
</div>
<div class="paragraph">
<p>Generic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">__getitem__</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">key</span><span class="tok-p">):</span>
        <span class="tok-k">if</span> <span class="tok-n">key</span> <span class="tok-o">==</span> <span class="tok-s">'1'</span><span class="tok-p">:</span>
            <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">()</span>
        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-k">try</span><span class="tok-p">:</span>
                <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">()[</span><span class="tok-n">key</span><span class="tok-p">]</span>
            <span class="tok-k">except</span> <span class="tok-ne">TypeError</span><span class="tok-p">:</span>
                <span class="tok-k">if</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">ext</span> <span class="tok-o">==</span> <span class="tok-s">'.json'</span><span class="tok-p">:</span>
                    <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">from_json</span><span class="tok-p">()[</span><span class="tok-n">key</span><span class="tok-p">]</span>
                <span class="tok-k">else</span><span class="tok-p">:</span>
                    <span class="tok-k">raise</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sectioned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">__getitem__</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">key</span><span class="tok-p">):</span>
        <span class="tok-k">try</span><span class="tok-p">:</span>
            <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">()[</span><span class="tok-n">key</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-p">]</span>
        <span class="tok-k">except</span> <span class="tok-ne">TypeError</span><span class="tok-p">:</span>
            <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">value</span><span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>KeyValue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">__getitem__</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">key</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">value</span><span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sqlite3KeyValueStorage value method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">value</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">key</span><span class="tok-p">):</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_cursor</span><span class="tok-o">.</span><span class="tok-n">execute</span><span class="tok-p">(</span><span class="tok-s">"SELECT value from kvstore where key = ?"</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">,))</span>
        <span class="tok-n">row</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_cursor</span><span class="tok-o">.</span><span class="tok-n">fetchone</span><span class="tok-p">()</span>
        <span class="tok-k">if</span> <span class="tok-ow">not</span> <span class="tok-n">row</span><span class="tok-p">:</span>
            <span class="tok-k">raise</span> <span class="tok-ne">Exception</span><span class="tok-p">(</span><span class="tok-s">"No value found for key '</span><span class="tok-si">%s</span><span class="tok-s">'"</span> <span class="tok-o">%</span> <span class="tok-n">key</span><span class="tok-p">)</span>
        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-k">return</span> <span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>JsonKeyValueStorage value method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">value</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">key</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">()[</span><span class="tok-n">key</span><span class="tok-p">]</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>__setitem__</code> method can also be implemented, to allow appending and
setting elements using the <code>[key]</code> syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">__setitem__</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">key</span><span class="tok-p">,</span> <span class="tok-n">value</span><span class="tok-p">):</span>
        <span class="tok-n">keyindex</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">keyindex</span><span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">)</span>
        <span class="tok-k">if</span> <span class="tok-n">keyindex</span> <span class="tok-o">&gt;=</span> <span class="tok-mi">0</span><span class="tok-p">:</span>
            <span class="tok-c"># Existing section.</span>
            <span class="tok-k">assert</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span><span class="tok-p">[</span><span class="tok-n">keyindex</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-p">][</span><span class="tok-s">'name'</span><span class="tok-p">]</span> <span class="tok-o">==</span> <span class="tok-n">key</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span><span class="tok-p">[</span><span class="tok-n">keyindex</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-p">][</span><span class="tok-s">'contents'</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">value</span>
        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-c"># New section.</span>
            <span class="tok-n">section_dict</span> <span class="tok-o">=</span> <span class="tok-p">{</span><span class="tok-s">"name"</span> <span class="tok-p">:</span> <span class="tok-n">key</span><span class="tok-p">,</span> <span class="tok-s">"contents"</span> <span class="tok-p">:</span> <span class="tok-n">value</span><span class="tok-p">}</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span><span class="tok-o">.</span><span class="tok-n">append</span><span class="tok-p">(</span><span class="tok-n">section_dict</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the <code>__delitem__</code> method allows using the <code>del</code> keyword to remove elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">__delitem__</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">key</span><span class="tok-p">):</span>
        <span class="tok-n">index</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">keyindex</span><span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">)</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">()</span><span class="tok-o">.</span><span class="tok-n">pop</span><span class="tok-p">(</span><span class="tok-n">index</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><a class="image" href="#"><i class="icon-shield" title="Test of Test Sectioned Data Setitem Delitem"></i></a></span></p>
</div>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">test_sectioned_data_setitem_delitem</span><span class="tok-p">():</span>
    <span class="tok-k">with</span> <span class="tok-n">wrap</span><span class="tok-p">()</span> <span class="tok-k">as</span> <span class="tok-n">wrapper</span><span class="tok-p">:</span>
        <span class="tok-n">contents</span><span class="tok-o">=</span><span class="tok-p">[</span>
                <span class="tok-p">{},</span>
                <span class="tok-p">{</span>
                    <span class="tok-s">"name"</span> <span class="tok-p">:</span> <span class="tok-s">"Welcome"</span><span class="tok-p">,</span>
                    <span class="tok-s">"contents"</span> <span class="tok-p">:</span> <span class="tok-s">"This is the first section."</span>
                <span class="tok-p">}</span>
            <span class="tok-p">]</span>

        <span class="tok-n">doc</span> <span class="tok-o">=</span> <span class="tok-n">Doc</span><span class="tok-p">(</span><span class="tok-s">"hello.txt"</span><span class="tok-p">,</span>
                <span class="tok-n">wrapper</span><span class="tok-p">,</span>
                <span class="tok-p">[],</span>
                <span class="tok-n">data_type</span><span class="tok-o">=</span><span class="tok-s">"sectioned"</span><span class="tok-p">,</span>
                <span class="tok-n">contents</span><span class="tok-o">=</span><span class="tok-n">contents</span>
                <span class="tok-p">)</span>

        <span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">run_docs</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">)</span>
        <span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">output_data</span><span class="tok-p">()</span>

        <span class="tok-k">assert</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">alias</span> <span class="tok-o">==</span> <span class="tok-s">'sectioned'</span>
        <span class="tok-k">assert</span> <span class="tok-nb">len</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>

        <span class="tok-c"># Add a new section</span>
        <span class="tok-n">data</span><span class="tok-p">[</span><span class="tok-s">"Conclusions"</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-s">"This is the final section."</span>

        <span class="tok-k">assert</span> <span class="tok-nb">len</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">2</span>

        <span class="tok-k">assert</span> <span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">[</span><span class="tok-s">'Welcome'</span><span class="tok-p">])</span> <span class="tok-o">==</span> <span class="tok-s">"This is the first section."</span>
        <span class="tok-k">assert</span> <span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">[</span><span class="tok-s">"Conclusions"</span><span class="tok-p">])</span> <span class="tok-o">==</span> <span class="tok-s">"This is the final section."</span>

        <span class="tok-c"># Modify an existing section</span>
        <span class="tok-n">data</span><span class="tok-p">[</span><span class="tok-s">"Welcome"</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-s">"This is the initial section."</span>

        <span class="tok-k">assert</span> <span class="tok-nb">len</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">2</span>

        <span class="tok-k">assert</span> <span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">[</span><span class="tok-s">'Welcome'</span><span class="tok-p">])</span> <span class="tok-o">==</span> <span class="tok-s">"This is the initial section."</span>
        <span class="tok-k">assert</span> <span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">[</span><span class="tok-s">"Conclusions"</span><span class="tok-p">])</span> <span class="tok-o">==</span> <span class="tok-s">"This is the final section."</span>

        <span class="tok-k">del</span> <span class="tok-n">data</span><span class="tok-p">[</span><span class="tok-s">"Conclusions"</span><span class="tok-p">]</span>

        <span class="tok-k">assert</span> <span class="tok-nb">len</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>
        <span class="tok-k">assert</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">keys</span><span class="tok-p">()</span> <span class="tok-o">==</span> <span class="tok-p">[</span><span class="tok-s">"Welcome"</span><span class="tok-p">]</span>
</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon"><a class="image" href="https://github.com/dexy/dexy/issues/108"><i class="icon-github icon-3x"></i></a></span> Desired Feature: Implement <em>setitem</em> for KeyValue data</p>
</div>
<div class="paragraph">
<p>Allow appending and setting elements using [key] = value syntax.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Updated at: 2013-11-20T01:32:25Z</p>
</li>
<li>
<p>Assigned to: None</p>
</li>
<li>
<p>Milestone: None</p>
</li>
</ul>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon"><a class="image" href="https://github.com/dexy/dexy/issues/109"><i class="icon-github icon-3x"></i></a></span> Desired Feature: Implement <em>delitem</em> for KeyValue data</p>
</div>
<div class="paragraph">
<p>Allow removing elements using <code>del</code> dict[key] syntax.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Updated at: 2013-11-20T01:37:44Z</p>
</li>
<li>
<p>Assigned to: None</p>
</li>
<li>
<p>Milestone: None</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_access_methods">Custom Access Methods</h3>
<div class="paragraph">
<p>Dictionary-style methods represent a generic interface which works for many
situations, and so these methods are implemented across several data types.</p>
</div>
<div class="paragraph">
<p>Some data types will have additional methods for searching or formatting data.
These can be seen using the <code>dexy datas</code> command with <code>-alias</code> argument.</p>
</div>
<div class="paragraph">
<p>The KeyValue data type implements a <code>like</code> method for using sqlite like
queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">like</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">key</span><span class="tok-p">):</span>
        <span class="tok-k">try</span><span class="tok-p">:</span>
            <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">like</span><span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">)</span>
        <span class="tok-k">except</span> <span class="tok-ne">AttributeError</span><span class="tok-p">:</span>
            <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"The `like()` method is not implemented for storage type '</span><span class="tok-si">%s</span><span class="tok-s">'"</span>
            <span class="tok-n">msgargs</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">alias</span>
            <span class="tok-k">raise</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">UserFeedback</span><span class="tok-p">(</span><span class="tok-n">msg</span> <span class="tok-o">%</span> <span class="tok-n">msgargs</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here’s the corresponding method on the Sqlite3KeyValueStorage class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">like</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">key</span><span class="tok-p">):</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_cursor</span><span class="tok-o">.</span><span class="tok-n">execute</span><span class="tok-p">(</span><span class="tok-s">"SELECT value from kvstore where key LIKE ?"</span><span class="tok-p">,</span> <span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">,))</span>
        <span class="tok-n">row</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_cursor</span><span class="tok-o">.</span><span class="tok-n">fetchone</span><span class="tok-p">()</span>
        <span class="tok-k">if</span> <span class="tok-ow">not</span> <span class="tok-n">row</span><span class="tok-p">:</span>
            <span class="tok-k">raise</span> <span class="tok-ne">Exception</span><span class="tok-p">(</span><span class="tok-s">"No value found for key '</span><span class="tok-si">%s</span><span class="tok-s">'"</span> <span class="tok-o">%</span> <span class="tok-n">key</span><span class="tok-p">)</span>
        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-k">return</span> <span class="tok-n">row</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_saving_data">Saving Data</h3>
<div class="paragraph">
<p>The <code>save()</code> method must be called to persist data to disk.</p>
</div>
<div class="paragraph">
<p>The <code>set_data()</code> shortcut method is also available, it sets data to the
provided value and then calls save.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">set_data</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">data</span><span class="tok-p">):</span>
        <span class="tok-sd">"""</span>
<span class="tok-sd">        Shortcut to set and save data.</span>
<span class="tok-sd">        """</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span> <span class="tok-o">=</span> <span class="tok-n">data</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">save</span><span class="tok-p">()</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here’s the implementation for <code>Generic</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">save</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">if</span> <span class="tok-nb">isinstance</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span><span class="tok-p">,</span> <span class="tok-nb">unicode</span><span class="tok-p">):</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">write_data</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span><span class="tok-o">.</span><span class="tok-n">encode</span><span class="tok-p">(</span><span class="tok-s">"utf-8"</span><span class="tok-p">))</span>
        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-k">if</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span> <span class="tok-o">==</span> <span class="tok-bp">None</span><span class="tok-p">:</span>
                <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"No data found for '</span><span class="tok-si">%s</span><span class="tok-s">', did you reference a file that doesn't exist?"</span>
                <span class="tok-k">raise</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">UserFeedback</span><span class="tok-p">(</span><span class="tok-n">msg</span> <span class="tok-o">%</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">)</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">write_data</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here’s the implementations for <code>Sectioned</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">save</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">try</span><span class="tok-p">:</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">write_data</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span><span class="tok-p">)</span>
        <span class="tok-k">except</span> <span class="tok-ne">Exception</span> <span class="tok-k">as</span> <span class="tok-n">e</span><span class="tok-p">:</span>
            <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"Problem saving '</span><span class="tok-si">%s</span><span class="tok-s">': </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">,</span> <span class="tok-nb">str</span><span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-p">))</span>
            <span class="tok-k">raise</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">InternalDexyProblem</span><span class="tok-p">(</span><span class="tok-n">msg</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here’s the implementation for <code>KeyValue</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">save</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">try</span><span class="tok-p">:</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">persist</span><span class="tok-p">()</span>
        <span class="tok-k">except</span> <span class="tok-ne">Exception</span> <span class="tok-k">as</span> <span class="tok-n">e</span><span class="tok-p">:</span>
            <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">u"Problem saving '</span><span class="tok-si">%s</span><span class="tok-s">': </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">,</span> <span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-p">))</span>
            <span class="tok-k">raise</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">InternalDexyProblem</span><span class="tok-p">(</span><span class="tok-n">msg</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">persist</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">if</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">connected_to</span> <span class="tok-o">==</span> <span class="tok-s">'existing'</span><span class="tok-p">:</span>
            <span class="tok-k">assert</span> <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">path</span><span class="tok-o">.</span><span class="tok-n">exists</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data_file</span><span class="tok-p">(</span><span class="tok-n">read</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">))</span>
        <span class="tok-k">elif</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">connected_to</span> <span class="tok-o">==</span> <span class="tok-s">'working'</span><span class="tok-p">:</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">assert_location_is_in_project_dir</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data_file</span><span class="tok-p">(</span><span class="tok-n">read</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">))</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_storage</span><span class="tok-o">.</span><span class="tok-n">commit</span><span class="tok-p">()</span>
            <span class="tok-n">shutil</span><span class="tok-o">.</span><span class="tok-n">copyfile</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">working_file</span><span class="tok-p">(),</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data_file</span><span class="tok-p">(</span><span class="tok-n">read</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">))</span>
        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"Unexpected 'connected_to' value </span><span class="tok-si">%s</span><span class="tok-s">"</span>
            <span class="tok-n">msgargs</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">connected_to</span>
            <span class="tok-k">raise</span> <span class="tok-n">InternalDexyProblem</span><span class="tok-p">(</span><span class="tok-n">msg</span> <span class="tok-o">%</span> <span class="tok-n">msgargs</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here’s the <code>persist</code> method for Sqlite3KeyValueStorage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">persist</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">if</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">connected_to</span> <span class="tok-o">==</span> <span class="tok-s">'existing'</span><span class="tok-p">:</span>
            <span class="tok-k">assert</span> <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">path</span><span class="tok-o">.</span><span class="tok-n">exists</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data_file</span><span class="tok-p">(</span><span class="tok-n">read</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">))</span>
        <span class="tok-k">elif</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">connected_to</span> <span class="tok-o">==</span> <span class="tok-s">'working'</span><span class="tok-p">:</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">assert_location_is_in_project_dir</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data_file</span><span class="tok-p">(</span><span class="tok-n">read</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">))</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_storage</span><span class="tok-o">.</span><span class="tok-n">commit</span><span class="tok-p">()</span>
            <span class="tok-n">shutil</span><span class="tok-o">.</span><span class="tok-n">copyfile</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">working_file</span><span class="tok-p">(),</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data_file</span><span class="tok-p">(</span><span class="tok-n">read</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">))</span>
        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"Unexpected 'connected_to' value </span><span class="tok-si">%s</span><span class="tok-s">"</span>
            <span class="tok-n">msgargs</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">connected_to</span>
            <span class="tok-k">raise</span> <span class="tok-n">InternalDexyProblem</span><span class="tok-p">(</span><span class="tok-n">msg</span> <span class="tok-o">%</span> <span class="tok-n">msgargs</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>And for JsonKeyValueStorage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">persist</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">write_data</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exporting_data">Exporting Data</h3>
<div class="paragraph">
<p>The <code>output_to_file</code> method writes data to a file. For Generic data this will
just be the raw data which may either be binary data or a string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">__unicode__</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">if</span> <span class="tok-nb">isinstance</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">(),</span> <span class="tok-nb">unicode</span><span class="tok-p">):</span>
            <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">()</span>
        <span class="tok-k">elif</span> <span class="tok-ow">not</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">():</span>
            <span class="tok-k">return</span> <span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-bp">None</span><span class="tok-p">)</span>
        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">decode_encoded</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">())</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Sectioned data, this writes the unicode-formatted data, so all sections
are combined into a single document, which is usually what you want for
final/canonical output at the end of processing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">__unicode__</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-s">u"</span><span class="tok-se">\n</span><span class="tok-s">"</span><span class="tok-o">.</span><span class="tok-n">join</span><span class="tok-p">(</span><span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">)</span> <span class="tok-k">for</span> <span class="tok-n">v</span> <span class="tok-ow">in</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">values</span><span class="tok-p">()</span> <span class="tok-k">if</span> <span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">))</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>There’s no concept of a canonical output for KeyValue data, it’s intended for
use in providing data to other documents.</p>
</div>
</div>
<div class="sect2">
<h3 id="_initializing_data_objects">Initializing Data Objects</h3>
<div class="paragraph">
<p>Data objects do some initialization work in <code>__init__</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">__init__</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">key</span><span class="tok-p">,</span> <span class="tok-n">ext</span><span class="tok-p">,</span> <span class="tok-n">storage_key</span><span class="tok-p">,</span> <span class="tok-n">settings</span><span class="tok-p">,</span> <span class="tok-n">wrapper</span><span class="tok-p">):</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">key</span> <span class="tok-o">=</span> <span class="tok-n">key</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">ext</span> <span class="tok-o">=</span> <span class="tok-n">ext</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage_key</span> <span class="tok-o">=</span> <span class="tok-n">storage_key</span>

        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">wrapper</span> <span class="tok-o">=</span> <span class="tok-n">wrapper</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">initialize_settings</span><span class="tok-p">(</span><span class="tok-o">**</span><span class="tok-n">settings</span><span class="tok-p">)</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">update_settings</span><span class="tok-p">(</span><span class="tok-n">settings</span><span class="tok-p">)</span>

        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">_data</span> <span class="tok-o">=</span> <span class="tok-bp">None</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">state</span> <span class="tok-o">=</span> <span class="tok-bp">None</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'canonical-name'</span><span class="tok-p">)</span>
        <span class="tok-k">if</span> <span class="tok-ow">not</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">name</span><span class="tok-p">:</span>
            <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"Document must provide canonical-name setting to data."</span>
            <span class="tok-k">raise</span> <span class="tok-n">InternalDexyProblem</span><span class="tok-p">(</span><span class="tok-n">msg</span><span class="tok-p">)</span>
        <span class="tok-k">elif</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">name</span><span class="tok-o">.</span><span class="tok-n">startswith</span><span class="tok-p">(</span><span class="tok-s">"("</span><span class="tok-p">):</span>
            <span class="tok-k">raise</span> <span class="tok-ne">Exception</span><span class="tok-p">()</span>

        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">transition</span><span class="tok-p">(</span><span class="tok-s">'new'</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>And more in <code>setup</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">setup</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">setup_storage</span><span class="tok-p">()</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">transition</span><span class="tok-p">(</span><span class="tok-s">'ready'</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>setup</code> method can be customized but it should always call the
<code>setup_storage</code> method and transition the state to <code>ready</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">setup_storage</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-n">storage_type</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage_class_alias</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">ext</span><span class="tok-p">)</span>
        <span class="tok-n">instanceargs</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage_key</span><span class="tok-p">,</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">ext</span><span class="tok-p">,</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">wrapper</span><span class="tok-p">,)</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span> <span class="tok-o">=</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">Storage</span><span class="tok-o">.</span><span class="tok-n">create_instance</span><span class="tok-p">(</span><span class="tok-n">storage_type</span><span class="tok-p">,</span> <span class="tok-o">*</span><span class="tok-n">instanceargs</span><span class="tok-p">)</span>

        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">assert_location_is_in_project_dir</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">name</span><span class="tok-p">)</span>

        <span class="tok-k">if</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">output_name</span><span class="tok-p">():</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">assert_location_is_in_project_dir</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">output_name</span><span class="tok-p">())</span>

        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">setup</span><span class="tok-p">()</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>storage_class_alias</code> method is responsible for choosing the correct type
of storage to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">storage_class_alias</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">file_ext</span><span class="tok-p">):</span>
        <span class="tok-k">return</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'storage-type'</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default this just reads the <code>storage-type</code> setting, but some classes may
automatically determine the class based on file extension.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reconstituting_data_objects">Reconstituting Data Objects</h3>
<div class="paragraph">
<p>Data objects are designed to be instantiated as standalone objects after a dexy
run, so their data can be used for reporting and querying. The <code>dexy grep</code>
command works by loading data objects directly.</p>
</div>
<div class="paragraph">
<p>To do this, the arguments needed to initialize a data object are stored in batch metadata.</p>
</div>
<div class="paragraph">
<p>The <code>args_to_data_init</code> method is called when saving batch metadata to provide
JSON-serializable initialization args for each data instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">args_to_data_init</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-sd">"""</span>
<span class="tok-sd">        Returns tuple of attributes to pass to create_instance.</span>
<span class="tok-sd">        """</span>
        <span class="tok-k">return</span> <span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">alias</span><span class="tok-p">,</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">,</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">ext</span><span class="tok-p">,</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">storage_key</span><span class="tok-p">,</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">setting_values</span><span class="tok-p">())</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>batch</code> objects can then recreate data objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">data</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">doc_key</span><span class="tok-p">,</span> <span class="tok-n">input_or_output</span><span class="tok-o">=</span><span class="tok-s">'output'</span><span class="tok-p">):</span>
        <span class="tok-sd">"""</span>
<span class="tok-sd">        Retrieves a data object given the doc key.</span>
<span class="tok-sd">        """</span>
        <span class="tok-n">doc_info</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">doc_info</span><span class="tok-p">(</span><span class="tok-n">doc_key</span><span class="tok-p">)[</span><span class="tok-s">"</span><span class="tok-si">%s</span><span class="tok-s">-data"</span> <span class="tok-o">%</span> <span class="tok-n">input_or_output</span><span class="tok-p">]</span>
        <span class="tok-n">args</span> <span class="tok-o">=</span> <span class="tok-nb">list</span><span class="tok-p">(</span><span class="tok-n">doc_info</span><span class="tok-p">)</span>
        <span class="tok-n">args</span><span class="tok-o">.</span><span class="tok-n">append</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">wrapper</span><span class="tok-p">)</span>
        <span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">Data</span><span class="tok-o">.</span><span class="tok-n">create_instance</span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-n">args</span><span class="tok-p">)</span>
        <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">setup_storage</span><span class="tok-p">()</span>
        <span class="tok-k">if</span> <span class="tok-nb">hasattr</span><span class="tok-p">(</span><span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-p">,</span> <span class="tok-s">'connect'</span><span class="tok-p">):</span>
            <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-o">.</span><span class="tok-n">connect</span><span class="tok-p">()</span>
        <span class="tok-k">return</span> <span class="tok-n">data</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_storage_objects">Storage Objects</h3>
<div class="paragraph">
<p>Storage objects are primarily concerned with reading and writing data to the
correct location on the file system or other form of storage, but sometimes
they will handle queries and other methods in order to provide user
transparency at the Data object leveel.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_filters">Filters</h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1">
<h2 id="_wrapper_batches">Wrapper &amp; Batches</h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1">
<h2 id="_parsers">Parsers</h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1">
<h2 id="_reporters">Reporters</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_website_reporter">Website Reporter</h3>
<div class="paragraph">
<p>The Website reporter publishes the same files as the Output reporter, but also
provides utilities designed for websites, such as applying templates to HTML
files and providing data to help users construct site navigation.</p>
</div>
<div class="paragraph">
<p>It doesn’t make sense to generate a website unless all dexy files are
generated, so the website reporter doesn’t run if a specific target is chosen
(many links would likely be broken too):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">run</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">wrapper</span><span class="tok-p">):</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">wrapper</span><span class="tok-o">=</span><span class="tok-n">wrapper</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">setup</span><span class="tok-p">()</span>

        <span class="tok-k">if</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">target</span><span class="tok-p">:</span>
            <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"Not running website reporter because a target has been specified."</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">log_warn</span><span class="tok-p">(</span><span class="tok-n">msg</span><span class="tok-p">)</span>
            <span class="tok-k">return</span>

        <span class="tok-k">for</span> <span class="tok-n">doc</span> <span class="tok-ow">in</span> <span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">nodes</span><span class="tok-o">.</span><span class="tok-n">values</span><span class="tok-p">():</span>
            <span class="tok-k">if</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">should_process</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">):</span>
                <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">process_doc</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">)</span>

        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">log_debug</span><span class="tok-p">(</span><span class="tok-s">"finished"</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>setup</code> method initializes some instance variables we will use later:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">setup</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">):</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">keys_to_outfiles</span> <span class="tok-o">=</span> <span class="tok-p">[]</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">locations</span> <span class="tok-o">=</span> <span class="tok-p">{}</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">create_reports_dir</span><span class="tok-p">()</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">setup_navobj</span><span class="tok-p">()</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we iterate over all the processed docs, the <code>should_process</code> method
determines whether they are properly formed Doc objects which are "canonical":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">should_process</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">doc</span><span class="tok-p">):</span>
        <span class="tok-k">if</span> <span class="tok-ow">not</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">key_with_class</span><span class="tok-p">()</span> <span class="tok-ow">in</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">batch</span><span class="tok-o">.</span><span class="tok-n">docs</span><span class="tok-p">:</span>
            <span class="tok-k">return</span> <span class="tok-bp">False</span>
        <span class="tok-k">elif</span> <span class="tok-ow">not</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">state</span> <span class="tok-ow">in</span> <span class="tok-p">(</span><span class="tok-s">'ran'</span><span class="tok-p">,</span> <span class="tok-s">'consolidated'</span><span class="tok-p">):</span>
            <span class="tok-k">return</span> <span class="tok-bp">False</span>
        <span class="tok-k">elif</span> <span class="tok-ow">not</span> <span class="tok-nb">hasattr</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">,</span> <span class="tok-s">'output_data'</span><span class="tok-p">):</span>
            <span class="tok-k">return</span> <span class="tok-bp">False</span>
        <span class="tok-k">elif</span> <span class="tok-ow">not</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">output_data</span><span class="tok-p">()</span><span class="tok-o">.</span><span class="tok-n">output_name</span><span class="tok-p">():</span>
            <span class="tok-k">return</span> <span class="tok-bp">False</span>
        <span class="tok-k">elif</span> <span class="tok-ow">not</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">output_data</span><span class="tok-p">()</span><span class="tok-o">.</span><span class="tok-n">is_canonical_output</span><span class="tok-p">():</span>
            <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"skipping </span><span class="tok-si">%s</span><span class="tok-s"> - not canonical"</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">log_debug</span><span class="tok-p">(</span><span class="tok-n">msg</span> <span class="tok-o">%</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">)</span>
            <span class="tok-k">return</span> <span class="tok-bp">False</span>
        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-k">return</span> <span class="tok-bp">True</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then <code>process_doc</code> runs the code which writes the document, with any templates
applied, to the report output directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">process_doc</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">doc</span><span class="tok-p">):</span>
        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">log_debug</span><span class="tok-p">(</span><span class="tok-s">"processing </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">)</span>

        <span class="tok-n">output_ext</span> <span class="tok-o">=</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">output_data</span><span class="tok-p">()</span><span class="tok-o">.</span><span class="tok-n">ext</span>

        <span class="tok-k">if</span> <span class="tok-n">output_ext</span> <span class="tok-o">==</span> <span class="tok-s">".html"</span><span class="tok-p">:</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">process_html</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">)</span>

        <span class="tok-k">elif</span> <span class="tok-nb">isinstance</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">output_data</span><span class="tok-p">(),</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">Sectioned</span><span class="tok-p">):</span>
            <span class="tok-k">assert</span> <span class="tok-n">output_ext</span> <span class="tok-o">==</span> <span class="tok-s">".json"</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">apply_and_render_template</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">)</span>

        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">write_canonical_data</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case of a HTML file, we may want to apply a template. This will depend
on whether the document already appears to have a HTML header, and the value
of the <code>ws-template</code> setting which may be a boolean or the name of a template
to apply.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">process_html</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">doc</span><span class="tok-p">):</span>
        <span class="tok-k">if</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'ws-template'</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-bp">False</span><span class="tok-p">:</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">log_debug</span><span class="tok-p">(</span><span class="tok-s">"  ws-template is False for </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">)</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">write_canonical_data</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">)</span>

        <span class="tok-k">elif</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">detect_html_header</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">)</span> <span class="tok-ow">and</span> <span class="tok-ow">not</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'ws-template'</span><span class="tok-p">):</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">log_debug</span><span class="tok-p">(</span><span class="tok-s">"  found html tag in output of </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">)</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">write_canonical_data</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">)</span>

        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">apply_and_render_template</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The header check is rather rudimentary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">detect_html_header</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">doc</span><span class="tok-p">):</span>
        <span class="tok-n">fragments</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-s">'&lt;html'</span><span class="tok-p">,</span> <span class="tok-s">'&lt;body'</span><span class="tok-p">,</span> <span class="tok-s">'&lt;head'</span><span class="tok-p">)</span>
        <span class="tok-k">return</span> <span class="tok-nb">any</span><span class="tok-p">(</span><span class="tok-n">html_fragment</span>
                      <span class="tok-ow">in</span> <span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">output_data</span><span class="tok-p">())</span>
                      <span class="tok-k">for</span> <span class="tok-n">html_fragment</span> <span class="tok-ow">in</span> <span class="tok-n">fragments</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>write_canonical_data</code> method is inherited from the Output class, and is
used when a document is not a HTML file or a setting determines that HTML
templates should not be applied:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">write_canonical_data</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">doc</span><span class="tok-p">):</span>
        <span class="tok-n">output_name</span> <span class="tok-o">=</span> <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">output_data</span><span class="tok-p">()</span><span class="tok-o">.</span><span class="tok-n">output_name</span><span class="tok-p">()</span>

        <span class="tok-k">if</span> <span class="tok-n">output_name</span><span class="tok-p">:</span>
            <span class="tok-n">fp</span> <span class="tok-o">=</span> <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">path</span><span class="tok-o">.</span><span class="tok-n">join</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'dir'</span><span class="tok-p">),</span> <span class="tok-n">output_name</span><span class="tok-p">)</span>

            <span class="tok-k">if</span> <span class="tok-n">fp</span> <span class="tok-ow">in</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">locations</span><span class="tok-p">:</span>
                <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">log_warn</span><span class="tok-p">(</span><span class="tok-s">"WARNING overwriting file </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">fp</span><span class="tok-p">)</span>
            <span class="tok-k">else</span><span class="tok-p">:</span>
                <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">locations</span><span class="tok-p">[</span><span class="tok-n">fp</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-p">[]</span>
            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">locations</span><span class="tok-p">[</span><span class="tok-n">fp</span><span class="tok-p">]</span><span class="tok-o">.</span><span class="tok-n">append</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">)</span>

            <span class="tok-n">parent_dir</span> <span class="tok-o">=</span> <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">path</span><span class="tok-o">.</span><span class="tok-n">dirname</span><span class="tok-p">(</span><span class="tok-n">fp</span><span class="tok-p">)</span>
            <span class="tok-k">try</span><span class="tok-p">:</span>
                <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">makedirs</span><span class="tok-p">(</span><span class="tok-n">parent_dir</span><span class="tok-p">)</span>
            <span class="tok-k">except</span> <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">error</span><span class="tok-p">:</span>
                <span class="tok-k">pass</span>

            <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">log_debug</span><span class="tok-p">(</span><span class="tok-s">"  writing </span><span class="tok-si">%s</span><span class="tok-s"> to </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">,</span> <span class="tok-n">fp</span><span class="tok-p">))</span>

            <span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">output_data</span><span class="tok-p">()</span><span class="tok-o">.</span><span class="tok-n">output_to_file</span><span class="tok-p">(</span><span class="tok-n">fp</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the other cases, the <code>apply_and_render_template</code> method is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">    <span class="tok-k">def</span> <span class="tok-nf">apply_and_render_template</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">,</span> <span class="tok-n">doc</span><span class="tok-p">):</span>
        <span class="tok-n">template_info</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">template_file_and_path</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">)</span>
        <span class="tok-n">template_file</span><span class="tok-p">,</span> <span class="tok-n">template_path</span> <span class="tok-o">=</span> <span class="tok-n">template_info</span>
        <span class="tok-n">env_data</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">template_environment</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-p">,</span> <span class="tok-n">template_path</span><span class="tok-p">)</span>

        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">log_debug</span><span class="tok-p">(</span><span class="tok-s">"  creating jinja environment"</span><span class="tok-p">)</span>
        <span class="tok-n">env</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">jinja_environment</span><span class="tok-p">(</span><span class="tok-n">template_path</span><span class="tok-p">)</span>

        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">log_debug</span><span class="tok-p">(</span><span class="tok-s">"  loading jinja template at </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">template_path</span><span class="tok-p">)</span>
        <span class="tok-n">template</span> <span class="tok-o">=</span> <span class="tok-n">env</span><span class="tok-o">.</span><span class="tok-n">get_template</span><span class="tok-p">(</span><span class="tok-n">template_path</span><span class="tok-p">)</span>

        <span class="tok-n">output_file</span> <span class="tok-o">=</span> <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">fix_ext</span><span class="tok-p">(</span><span class="tok-n">doc</span><span class="tok-o">.</span><span class="tok-n">output_data</span><span class="tok-p">()</span><span class="tok-o">.</span><span class="tok-n">output_name</span><span class="tok-p">())</span>
        <span class="tok-n">output_path</span> <span class="tok-o">=</span> <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">path</span><span class="tok-o">.</span><span class="tok-n">join</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'dir'</span><span class="tok-p">),</span> <span class="tok-n">output_file</span><span class="tok-p">)</span>

        <span class="tok-k">try</span><span class="tok-p">:</span>
            <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">makedirs</span><span class="tok-p">(</span><span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">path</span><span class="tok-o">.</span><span class="tok-n">dirname</span><span class="tok-p">(</span><span class="tok-n">output_path</span><span class="tok-p">))</span>
        <span class="tok-k">except</span> <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">error</span><span class="tok-p">:</span>
            <span class="tok-k">pass</span>

        <span class="tok-bp">self</span><span class="tok-o">.</span><span class="tok-n">log_debug</span><span class="tok-p">(</span><span class="tok-s">"  writing to </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-n">output_path</span><span class="tok-p">))</span>
        <span class="tok-n">template</span><span class="tok-o">.</span><span class="tok-n">stream</span><span class="tok-p">(</span><span class="tok-n">env_data</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">dump</span><span class="tok-p">(</span><span class="tok-n">output_path</span><span class="tok-p">,</span> <span class="tok-n">encoding</span><span class="tok-o">=</span><span class="tok-s">"utf-8"</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_templates">Templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Templates are ways of creating dexy examples.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_command_line_interface">Command Line Interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The command line interface for dexy is driven by
<a href="https://pypi.python.org/pypi/python-modargs">python-modargs</a>.</p>
</div>
<div class="sect2">
<h3 id="_init_py">init.py</h3>
<div class="paragraph">
<p>Any function ending with <code>_command</code> is automatically exposed as a command. To
keep modules to a manageable size, the various dexy commands are defined in
different modules, but all are imported into <code>dexy.commands</code> in the
<code>__init__.py</code> file so they can be available to modargs within a single module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.info</span> <span class="tok-kn">import</span> <span class="tok-n">links_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.cite</span> <span class="tok-kn">import</span> <span class="tok-n">cite_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.parsers</span> <span class="tok-kn">import</span> <span class="tok-n">parsers_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.conf</span> <span class="tok-kn">import</span> <span class="tok-n">conf_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.dirs</span> <span class="tok-kn">import</span> <span class="tok-n">cleanup_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.dirs</span> <span class="tok-kn">import</span> <span class="tok-n">reset_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.dirs</span> <span class="tok-kn">import</span> <span class="tok-n">setup_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.env</span> <span class="tok-kn">import</span> <span class="tok-n">env_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.env</span> <span class="tok-kn">import</span> <span class="tok-n">datas_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.env</span> <span class="tok-kn">import</span> <span class="tok-n">plugins_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.fcmds</span> <span class="tok-kn">import</span> <span class="tok-n">fcmd_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.fcmds</span> <span class="tok-kn">import</span> <span class="tok-n">fcmds_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.filters</span> <span class="tok-kn">import</span> <span class="tok-n">filters_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.filters</span> <span class="tok-kn">import</span> <span class="tok-n">filters_command</span> <span class="tok-k">as</span> <span class="tok-n">filter_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.grep</span> <span class="tok-kn">import</span> <span class="tok-n">grep_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.info</span> <span class="tok-kn">import</span> <span class="tok-n">info_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.it</span> <span class="tok-kn">import</span> <span class="tok-n">dexy_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.it</span> <span class="tok-kn">import</span> <span class="tok-n">it_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.it</span> <span class="tok-kn">import</span> <span class="tok-n">targets_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.nodes</span> <span class="tok-kn">import</span> <span class="tok-n">nodes_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.reporters</span> <span class="tok-kn">import</span> <span class="tok-n">reporters_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.reporters</span> <span class="tok-kn">import</span> <span class="tok-n">reporters_command</span> <span class="tok-k">as</span> <span class="tok-n">reports_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.serve</span> <span class="tok-kn">import</span> <span class="tok-n">serve_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.templates</span> <span class="tok-kn">import</span> <span class="tok-n">gen_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.templates</span> <span class="tok-kn">import</span> <span class="tok-n">template_command</span>
<span class="tok-kn">from</span> <span class="tok-nn">dexy.commands.templates</span> <span class="tok-kn">import</span> <span class="tok-n">templates_command</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>run</code> method in <code>dexy.commands</code> is listed in <code>setup.py</code> as a console script entry point:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python">        <span class="tok-n">entry_points</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-s">'console_scripts'</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
                <span class="tok-s">'dexy = dexy.commands:run'</span>
                <span class="tok-p">],</span>
            <span class="tok-s">'pygments.lexers'</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
                <span class="tok-s">'rst+django = dexy.filters.utils:RstDjangoLexer'</span>
                <span class="tok-p">]</span>
            <span class="tok-p">},</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>And this is the first method which will be called whenever a user enters a <code>dexy</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">run</span><span class="tok-p">():</span>
    <span class="tok-n">capture_warnings</span><span class="tok-p">()</span>
    <span class="tok-n">parse_and_run_cmd</span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-n">resolve_argv</span><span class="tok-p">())</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>capture_warnings</code> method just hides irrelevant warning messages from dexy users:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">capture_warnings</span><span class="tok-p">():</span>
    <span class="tok-sd">"""</span>
<span class="tok-sd">    Capture deprecation messages and other irrelevant warnings in whatever way</span>
<span class="tok-sd">    is appropriate to the dexy version.</span>
<span class="tok-sd">    """</span>
    <span class="tok-k">if</span> <span class="tok-nb">hasattr</span><span class="tok-p">(</span><span class="tok-n">logging</span><span class="tok-p">,</span> <span class="tok-s">'captureWarnings'</span><span class="tok-p">):</span>
        <span class="tok-n">logging</span><span class="tok-o">.</span><span class="tok-n">captureWarnings</span><span class="tok-p">(</span><span class="tok-bp">True</span><span class="tok-p">)</span>
    <span class="tok-k">else</span><span class="tok-p">:</span>
        <span class="tok-n">warnings</span><span class="tok-o">.</span><span class="tok-n">filterwarnings</span><span class="tok-p">(</span><span class="tok-s">"ignore"</span><span class="tok-p">,</span><span class="tok-n">category</span><span class="tok-o">=</span><span class="tok-ne">Warning</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dexy can load a lot of different libraries as it runs various filters, and
deprecation messages and similar warnings are confusing and annoying for end
users.</p>
</div>
<div class="paragraph">
<p>The <code>resolve_argv</code> method is called next:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">resolve_argv</span><span class="tok-p">():</span>
    <span class="tok-sd">"""</span>
<span class="tok-sd">    Do some processing of the user-provided arguments in argv before they go to</span>
<span class="tok-sd">    modargs so we can support commands defined in plugins.</span>
<span class="tok-sd">    """</span>
    <span class="tok-n">only_one_arg</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-nb">len</span><span class="tok-p">(</span><span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">argv</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-mi">1</span><span class="tok-p">)</span>
    <span class="tok-n">second_arg_is_known_cmd</span> <span class="tok-o">=</span> <span class="tok-ow">not</span> <span class="tok-n">only_one_arg</span> <span class="tok-ow">and</span> \
        <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span> <span class="tok-ow">in</span> <span class="tok-n">args</span><span class="tok-o">.</span><span class="tok-n">available_commands</span><span class="tok-p">(</span><span class="tok-n">dexy_cmd_mod</span><span class="tok-p">)</span>
    <span class="tok-n">second_arg_is_option</span> <span class="tok-o">=</span> <span class="tok-ow">not</span> <span class="tok-n">only_one_arg</span> <span class="tok-ow">and</span> \
        <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span><span class="tok-o">.</span><span class="tok-n">startswith</span><span class="tok-p">(</span><span class="tok-s">"-"</span><span class="tok-p">)</span>

    <span class="tok-k">if</span> <span class="tok-n">only_one_arg</span> <span class="tok-ow">or</span> <span class="tok-n">second_arg_is_known_cmd</span> <span class="tok-ow">or</span> <span class="tok-n">second_arg_is_option</span><span class="tok-p">:</span>
        <span class="tok-k">return</span> <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">:],</span> <span class="tok-n">dexy_cmd_mod</span><span class="tok-p">,</span> <span class="tok-n">dexy_default_cmd</span>

    <span class="tok-k">else</span><span class="tok-p">:</span>
        <span class="tok-n">cmd</span><span class="tok-p">,</span> <span class="tok-n">subcmd</span><span class="tok-p">,</span> <span class="tok-n">cmd_mod</span> <span class="tok-o">=</span> <span class="tok-n">resolve_plugin_cmd</span><span class="tok-p">(</span><span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">])</span>
        <span class="tok-n">default_cmd</span> <span class="tok-o">=</span> <span class="tok-n">cmd</span><span class="tok-o">.</span><span class="tok-n">default_cmd</span> <span class="tok-ow">or</span> <span class="tok-n">cmd</span><span class="tok-o">.</span><span class="tok-n">namespace</span>
        <span class="tok-k">return</span> <span class="tok-p">[</span><span class="tok-n">subcmd</span><span class="tok-p">]</span> <span class="tok-o">+</span> <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">argv</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">:],</span> <span class="tok-n">cmd_mod</span><span class="tok-p">,</span> <span class="tok-n">default_cmd</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>It’s possible for additional commands to be added to dexy via the plugin
system.  For example, the <code>dexy-viewer</code> plugin defines a <code>ping</code> command which
can be called as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="console language-console"><span class="tok-gp">$</span> dexy viewer:ping
<span class="tok-go">pong</span>
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-nd">@patch.object</span><span class="tok-p">(</span><span class="tok-n">sys</span><span class="tok-p">,</span> <span class="tok-s">'argv'</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s">'dexy'</span><span class="tok-p">,</span> <span class="tok-s">'viewer:ping'</span><span class="tok-p">])</span>
<span class="tok-nd">@patch</span><span class="tok-p">(</span><span class="tok-s">'sys.stdout'</span><span class="tok-p">,</span> <span class="tok-n">new_callable</span><span class="tok-o">=</span><span class="tok-n">StringIO</span><span class="tok-p">)</span>
<span class="tok-k">def</span> <span class="tok-nf">test_viewer_command</span><span class="tok-p">(</span><span class="tok-n">stdout</span><span class="tok-p">):</span>
    <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">commands</span><span class="tok-o">.</span><span class="tok-n">run</span><span class="tok-p">()</span>
    <span class="tok-k">assert</span> <span class="tok-s">"pong"</span> <span class="tok-ow">in</span> <span class="tok-n">stdout</span><span class="tok-o">.</span><span class="tok-n">getvalue</span><span class="tok-p">()</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If necessary the <code>resolve_argv</code> command calls <code>resolve_plugin_command</code> to
look in dexy plugins for the requested command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">resolve_plugin_cmd</span><span class="tok-p">(</span><span class="tok-n">raw_command_name</span><span class="tok-p">):</span>
    <span class="tok-sd">"""</span>
<span class="tok-sd">    Take a command name like viewer:run and return the command method and</span>
<span class="tok-sd">    module object.</span>
<span class="tok-sd">    """</span>
    <span class="tok-k">if</span> <span class="tok-s">":"</span> <span class="tok-ow">in</span> <span class="tok-n">raw_command_name</span><span class="tok-p">:</span>
        <span class="tok-n">alias</span><span class="tok-p">,</span> <span class="tok-n">subcommand</span> <span class="tok-o">=</span> <span class="tok-n">raw_command_name</span><span class="tok-o">.</span><span class="tok-n">split</span><span class="tok-p">(</span><span class="tok-s">":"</span><span class="tok-p">)</span>
    <span class="tok-k">else</span><span class="tok-p">:</span>
        <span class="tok-n">alias</span><span class="tok-p">,</span> <span class="tok-n">subcommand</span> <span class="tok-o">=</span> <span class="tok-n">raw_command_name</span><span class="tok-p">,</span> <span class="tok-s">''</span>

    <span class="tok-k">try</span><span class="tok-p">:</span>
        <span class="tok-n">cmd</span> <span class="tok-o">=</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">plugin</span><span class="tok-o">.</span><span class="tok-n">Command</span><span class="tok-o">.</span><span class="tok-n">create_instance</span><span class="tok-p">(</span><span class="tok-n">alias</span><span class="tok-p">)</span>
    <span class="tok-k">except</span> <span class="tok-n">cashew</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">NoPlugin</span><span class="tok-p">:</span>
        <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"""No command '</span><span class="tok-si">%s</span><span class="tok-s">' available.</span>
<span class="tok-s">        Run `dexy help --all` to see list of available commands."""</span>
        <span class="tok-n">msgargs</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-n">alias</span><span class="tok-p">)</span>
        <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">stderr</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">inspect</span><span class="tok-o">.</span><span class="tok-n">cleandoc</span><span class="tok-p">(</span><span class="tok-n">msg</span><span class="tok-p">)</span> <span class="tok-o">%</span> <span class="tok-n">msgargs</span><span class="tok-p">)</span>
        <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">stderr</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">linesep</span><span class="tok-p">)</span>
        <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">exit</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">)</span>

    <span class="tok-n">mod_name</span> <span class="tok-o">=</span> <span class="tok-n">cmd</span><span class="tok-o">.</span><span class="tok-n">__module__</span>
    <span class="tok-n">cmd_mod</span> <span class="tok-o">=</span> <span class="tok-n">args</span><span class="tok-o">.</span><span class="tok-n">load_module</span><span class="tok-p">(</span><span class="tok-n">mod_name</span><span class="tok-p">)</span>

    <span class="tok-k">return</span> <span class="tok-n">cmd</span><span class="tok-p">,</span> <span class="tok-n">subcommand</span><span class="tok-p">,</span> <span class="tok-n">cmd_mod</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Returning to the <code>run</code> command we started with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">run</span><span class="tok-p">():</span>
    <span class="tok-n">capture_warnings</span><span class="tok-p">()</span>
    <span class="tok-n">parse_and_run_cmd</span><span class="tok-p">(</span><span class="tok-o">*</span><span class="tok-n">resolve_argv</span><span class="tok-p">())</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The parsed arguments, module object and a default command are passed to
<code>parse_and_run_cmd</code> which delegates to the modargs command of the same name,
and wraps the call with error handling to provide nicer error messages if
there’s a problem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">parse_and_run_cmd</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">,</span> <span class="tok-n">module</span><span class="tok-p">,</span> <span class="tok-n">default_command</span><span class="tok-p">):</span>
    <span class="tok-k">try</span><span class="tok-p">:</span>
        <span class="tok-n">args</span><span class="tok-o">.</span><span class="tok-n">parse_and_run_command</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">,</span> <span class="tok-n">module</span><span class="tok-p">,</span> <span class="tok-n">default_command</span><span class="tok-p">)</span>
    <span class="tok-k">except</span> <span class="tok-p">(</span><span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">UserFeedback</span><span class="tok-p">,</span> <span class="tok-n">cashew</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">UserFeedback</span><span class="tok-p">)</span> <span class="tok-k">as</span> <span class="tok-n">e</span><span class="tok-p">:</span>
        <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">u"""Oops, there's a problem running your command.</span>
<span class="tok-s">        Here is some more information:"""</span>
        <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">stderr</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">inspect</span><span class="tok-o">.</span><span class="tok-n">cleandoc</span><span class="tok-p">(</span><span class="tok-n">msg</span><span class="tok-p">))</span>
        <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">stderr</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">linesep</span><span class="tok-p">)</span>

        <span class="tok-n">err_msg</span> <span class="tok-o">=</span> <span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-p">)</span>
        <span class="tok-k">if</span> <span class="tok-n">err_msg</span><span class="tok-p">:</span>
            <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">stderr</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-s">u"'</span><span class="tok-si">%s</span><span class="tok-s">'"</span> <span class="tok-o">%</span> <span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-p">))</span>
        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">stderr</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-s">u"Sorry, can't get text of error message."</span><span class="tok-p">)</span>

        <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">stderr</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">linesep</span><span class="tok-p">)</span>
        <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">exit</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">)</span>

    <span class="tok-k">except</span> <span class="tok-ne">KeyboardInterrupt</span><span class="tok-p">:</span>
        <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">stderr</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-s">"stopping..."</span><span class="tok-p">)</span>
        <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">stderr</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">linesep</span><span class="tok-p">)</span>
        <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">exit</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>help</code> and <code>version</code> commands are also defined in the <code>__init__.py</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">help_command</span><span class="tok-p">(</span>
        <span class="tok-nb">all</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">,</span> <span class="tok-c"># List all available dexy commands (auto-generated).</span>
        <span class="tok-n">on</span><span class="tok-o">=</span><span class="tok-bp">False</span> <span class="tok-c"># Get help on a particular dexy command.</span>
    <span class="tok-p">):</span>

    <span class="tok-k">if</span> <span class="tok-nb">all</span> <span class="tok-ow">and</span> <span class="tok-ow">not</span> <span class="tok-n">on</span><span class="tok-p">:</span>
        <span class="tok-k">print</span> <span class="tok-s">""</span>
        <span class="tok-n">args</span><span class="tok-o">.</span><span class="tok-n">help_command</span><span class="tok-p">(</span><span class="tok-n">prog</span><span class="tok-p">,</span> <span class="tok-n">dexy_cmd_mod</span><span class="tok-p">,</span> <span class="tok-n">dexy_default_cmd</span><span class="tok-p">,</span> <span class="tok-n">on</span><span class="tok-p">)</span>
        <span class="tok-k">print</span> <span class="tok-s">""</span>

    <span class="tok-k">elif</span> <span class="tok-ow">not</span> <span class="tok-n">on</span><span class="tok-p">:</span>
        <span class="tok-k">print</span> <span class="tok-s">""</span>
        <span class="tok-k">print</span> <span class="tok-s">"For help on the main `dexy` command, run `dexy help -on dexy`."</span>
        <span class="tok-k">print</span> <span class="tok-s">""</span>
        <span class="tok-k">print</span> <span class="tok-s">"The dexy tool includes several different commands:"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy help --all` lists all available commands"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy help --on XXX` provides help on a specific command"</span>
        <span class="tok-k">print</span> <span class="tok-s">""</span>
        <span class="tok-k">print</span> <span class="tok-s">"Commands for running dexy:"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy` runs dexy"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy setup` makes directories dexy needs"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy cleanup` removes directories dexy has created"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy reset` empties and resets dexy's working directories"</span>
        <span class="tok-k">print</span> <span class="tok-s">""</span>
        <span class="tok-k">print</span> <span class="tok-s">"Commands which print lists of dexy features:"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy filters` filters like |jinja |py |javac"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy reports` reporters like `output` and `run`"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy nodes` node types and their document settings"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy datas` data types and available methods"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy env` elements available in document templates"</span>
        <span class="tok-k">print</span> <span class="tok-s">""</span>
        <span class="tok-k">print</span> <span class="tok-s">"Commands which print information about your project:"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  (you need to be in the project dir and have run dexy already)"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy grep` search for documents and keys in documents"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy info` list metadata about a particular document"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy targets` list target names you can run"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy links` list all ways to refer to documents and sections"</span>
        <span class="tok-k">print</span> <span class="tok-s">""</span>
        <span class="tok-k">print</span> <span class="tok-s">"Other commands:"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy serve` start a local static web server to view generated docs"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy help` you're reading it"</span>
        <span class="tok-k">print</span> <span class="tok-s">"  `dexy version` print the version of dexy software which is installed"</span>
        <span class="tok-k">print</span> <span class="tok-s">""</span>

    <span class="tok-k">else</span><span class="tok-p">:</span>
        <span class="tok-k">try</span><span class="tok-p">:</span>
            <span class="tok-n">args</span><span class="tok-o">.</span><span class="tok-n">help_command</span><span class="tok-p">(</span><span class="tok-n">prog</span><span class="tok-p">,</span> <span class="tok-n">dexy_cmd_mod</span><span class="tok-p">,</span> <span class="tok-n">dexy_default_cmd</span><span class="tok-p">,</span> <span class="tok-n">on</span><span class="tok-p">)</span>

        <span class="tok-k">except</span> <span class="tok-ne">KeyError</span><span class="tok-p">:</span>
            <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">stderr</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-s">"Could not find help on '</span><span class="tok-si">%s</span><span class="tok-s">'."</span> <span class="tok-o">%</span> <span class="tok-n">on</span><span class="tok-p">)</span>
            <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">stderr</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">linesep</span><span class="tok-p">)</span>
            <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">exit</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">version_command</span><span class="tok-p">():</span>
    <span class="tok-sd">"""</span>
<span class="tok-sd">    Print the version number of dexy.</span>
<span class="tok-sd">    """</span>
    <span class="tok-k">print</span> <span class="tok-s">"</span><span class="tok-si">%s</span><span class="tok-s"> version </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-n">prog</span><span class="tok-p">,</span> <span class="tok-n">DEXY_VERSION</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cite_py">cite.py</h3>
<div class="paragraph">
<p>The <code>dexy cite</code> command prints out a bibliographic citation for dexy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">cite_command</span><span class="tok-p">(</span>
        <span class="tok-n">fmt</span><span class="tok-o">=</span><span class="tok-s">'bibtex'</span> <span class="tok-c"># desired format of citation</span>
        <span class="tok-p">):</span>
    <span class="tok-sd">"""</span>
<span class="tok-sd">    How to cite dexy in papers.</span>
<span class="tok-sd">    """</span>
    <span class="tok-k">if</span> <span class="tok-n">fmt</span> <span class="tok-o">==</span> <span class="tok-s">'bibtex'</span><span class="tok-p">:</span>
        <span class="tok-n">cite_bibtex</span><span class="tok-p">()</span>
    <span class="tok-k">else</span><span class="tok-p">:</span>
        <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"Don't know how to provide citation in '</span><span class="tok-si">%s</span><span class="tok-s">' format"</span>
        <span class="tok-k">raise</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">UserFeedback</span><span class="tok-p">(</span><span class="tok-n">msg</span> <span class="tok-o">%</span> <span class="tok-n">fmt</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="console language-console"><span class="tok-gp">$</span> dexy cite
<span class="tok-go">@misc{Dexy,</span>
<span class="tok-go">    title = {Dexy: Reproducible Data Analysis and Document Automation Software, Version~1.0.0d},</span>
<span class="tok-go">    author = {{Nelson, Ana}},</span>
<span class="tok-go">    year = {2013},</span>
<span class="tok-go">    url = {http://www.dexy.it/},</span>
<span class="tok-go">    note = {http://orcid.org/0000-0003-2561-1564}</span>
<span class="tok-go">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently the bibtex format is supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">bibtex_text</span><span class="tok-p">():</span>
    <span class="tok-n">args</span> <span class="tok-o">=</span> <span class="tok-p">{</span>
            <span class="tok-s">'version'</span> <span class="tok-p">:</span> <span class="tok-n">DEXY_VERSION</span><span class="tok-p">,</span>
            <span class="tok-s">'year'</span> <span class="tok-p">:</span> <span class="tok-n">datetime</span><span class="tok-o">.</span><span class="tok-n">date</span><span class="tok-o">.</span><span class="tok-n">today</span><span class="tok-p">()</span><span class="tok-o">.</span><span class="tok-n">year</span>
            <span class="tok-p">}</span>

    <span class="tok-k">return</span> <span class="tok-s">"""@misc{Dexy,</span>
<span class="tok-s">    title = {Dexy: Reproducible Data Analysis and Document Automation Software, Version~</span><span class="tok-si">%(version)s</span><span class="tok-s">},</span>
<span class="tok-s">    author = {{Nelson, Ana}},</span>
<span class="tok-s">    year = {</span><span class="tok-si">%(year)s</span><span class="tok-s">},</span>
<span class="tok-s">    url = {http://www.dexy.it/},</span>
<span class="tok-s">    note = {http://orcid.org/0000-0003-2561-1564}</span>
<span class="tok-s">}"""</span> <span class="tok-o">%</span> <span class="tok-n">args</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conf_py">conf.py</h3>
<div class="paragraph">
<p>The main dexy command has a lot of command line options, and for convenience
you can save the option values in a <code>dexy.conf</code> file in your project so you
don’t have to remember and type them all the time. The <code>dexy conf</code> command
generates an example file for you containing all the default dexy options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">conf_command</span><span class="tok-p">(</span>
        <span class="tok-n">conf</span><span class="tok-o">=</span><span class="tok-n">defaults</span><span class="tok-p">[</span><span class="tok-s">'config_file'</span><span class="tok-p">],</span> <span class="tok-c"># name of config file to write to</span>
        <span class="tok-n">p</span><span class="tok-o">=</span><span class="tok-bp">False</span> <span class="tok-c"># whether to print to stdout rather than write to file</span>
        <span class="tok-p">):</span>
    <span class="tok-sd">"""</span>
<span class="tok-sd">    Write a config file containing dexy's defaults.</span>
<span class="tok-sd">    """</span>
    <span class="tok-k">if</span> <span class="tok-n">file_exists</span><span class="tok-p">(</span><span class="tok-n">conf</span><span class="tok-p">)</span> <span class="tok-ow">and</span> <span class="tok-ow">not</span> <span class="tok-n">p</span><span class="tok-p">:</span>
        <span class="tok-k">print</span> <span class="tok-n">inspect</span><span class="tok-o">.</span><span class="tok-n">cleandoc</span><span class="tok-p">(</span><span class="tok-s">"""Config file </span><span class="tok-si">%s</span><span class="tok-s"> already exists,</span>
<span class="tok-s">        will print conf to stdout instead..."""</span> <span class="tok-o">%</span> <span class="tok-n">conf</span><span class="tok-p">)</span>
        <span class="tok-n">p</span> <span class="tok-o">=</span> <span class="tok-bp">True</span>

    <span class="tok-n">config</span> <span class="tok-o">=</span> <span class="tok-n">default_config</span><span class="tok-p">()</span>

    <span class="tok-c"># Can't specify config file name in config file.</span>
    <span class="tok-k">del</span> <span class="tok-n">config</span><span class="tok-p">[</span><span class="tok-s">'conf'</span><span class="tok-p">]</span>

    <span class="tok-n">yaml_help</span> <span class="tok-o">=</span> <span class="tok-n">inspect</span><span class="tok-o">.</span><span class="tok-n">cleandoc</span><span class="tok-p">(</span><span class="tok-s">"""# YAML config file for dexy.</span>
<span class="tok-s">        # You can delete any lines you don't wish to customize.</span>
<span class="tok-s">        # Options are same as command line options,</span>
<span class="tok-s">        # for more info run 'dexy help -on dexy'.</span>
<span class="tok-s">        """</span><span class="tok-p">)</span>

    <span class="tok-k">if</span> <span class="tok-n">p</span><span class="tok-p">:</span>
        <span class="tok-k">print</span> <span class="tok-n">yaml</span><span class="tok-o">.</span><span class="tok-n">dump</span><span class="tok-p">(</span><span class="tok-n">config</span><span class="tok-p">,</span> <span class="tok-n">default_flow_style</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">)</span>
    <span class="tok-k">else</span><span class="tok-p">:</span>
        <span class="tok-k">with</span> <span class="tok-nb">open</span><span class="tok-p">(</span><span class="tok-n">conf</span><span class="tok-p">,</span> <span class="tok-s">"wb"</span><span class="tok-p">)</span> <span class="tok-k">as</span> <span class="tok-n">f</span><span class="tok-p">:</span>
            <span class="tok-k">if</span> <span class="tok-n">conf</span><span class="tok-o">.</span><span class="tok-n">endswith</span><span class="tok-p">(</span><span class="tok-s">".yaml"</span><span class="tok-p">)</span> <span class="tok-ow">or</span> <span class="tok-n">conf</span><span class="tok-o">.</span><span class="tok-n">endswith</span><span class="tok-p">(</span><span class="tok-s">".conf"</span><span class="tok-p">):</span>
                <span class="tok-n">f</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">yaml_help</span><span class="tok-p">)</span>
                <span class="tok-n">f</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">linesep</span><span class="tok-p">)</span>
                <span class="tok-n">f</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-n">yaml</span><span class="tok-o">.</span><span class="tok-n">dump</span><span class="tok-p">(</span><span class="tok-n">config</span><span class="tok-p">,</span> <span class="tok-n">default_flow_style</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">))</span>
            <span class="tok-k">elif</span> <span class="tok-n">conf</span><span class="tok-o">.</span><span class="tok-n">endswith</span><span class="tok-p">(</span><span class="tok-s">".json"</span><span class="tok-p">):</span>
                <span class="tok-n">json</span><span class="tok-o">.</span><span class="tok-n">dump</span><span class="tok-p">(</span><span class="tok-n">config</span><span class="tok-p">,</span> <span class="tok-n">f</span><span class="tok-p">,</span> <span class="tok-n">sort_keys</span><span class="tok-o">=</span><span class="tok-bp">True</span><span class="tok-p">,</span> <span class="tok-n">indent</span><span class="tok-o">=</span><span class="tok-mi">4</span><span class="tok-p">)</span>
            <span class="tok-k">else</span><span class="tok-p">:</span>
                <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"Don't know how to write config file '</span><span class="tok-si">%s</span><span class="tok-s">'"</span>
                <span class="tok-k">raise</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">UserFeedback</span><span class="tok-p">(</span><span class="tok-n">msg</span> <span class="tok-o">%</span> <span class="tok-n">conf</span><span class="tok-p">)</span>

        <span class="tok-k">print</span> <span class="tok-s">"Config file has been written to '</span><span class="tok-si">%s</span><span class="tok-s">'"</span> <span class="tok-o">%</span> <span class="tok-n">conf</span>
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="console language-console"><span class="tok-gp">$</span> dexy conf
<span class="tok-go">Config file has been written to 'dexy.conf'</span>
<span class="tok-gp">$</span> ls
<span class="tok-go">commands.sh.txt  dexy.conf</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a config file already exists, or if you use the <code>-p</code> flag, then config
options are written to stdout instead of written to a file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-nd">@patch.object</span><span class="tok-p">(</span><span class="tok-n">sys</span><span class="tok-p">,</span> <span class="tok-s">'argv'</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s">'dexy'</span><span class="tok-p">,</span> <span class="tok-s">'conf'</span><span class="tok-p">])</span>
<span class="tok-nd">@patch</span><span class="tok-p">(</span><span class="tok-s">'sys.stdout'</span><span class="tok-p">,</span> <span class="tok-n">new_callable</span><span class="tok-o">=</span><span class="tok-n">StringIO</span><span class="tok-p">)</span>
<span class="tok-k">def</span> <span class="tok-nf">test_conf_command</span><span class="tok-p">(</span><span class="tok-n">stdout</span><span class="tok-p">):</span>
    <span class="tok-k">with</span> <span class="tok-n">tempdir</span><span class="tok-p">():</span>
        <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">commands</span><span class="tok-o">.</span><span class="tok-n">run</span><span class="tok-p">()</span>
        <span class="tok-k">assert</span> <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">path</span><span class="tok-o">.</span><span class="tok-n">exists</span><span class="tok-p">(</span><span class="tok-s">"dexy.conf"</span><span class="tok-p">)</span>
        <span class="tok-k">assert</span> <span class="tok-s">"has been written"</span> <span class="tok-ow">in</span> <span class="tok-n">stdout</span><span class="tok-o">.</span><span class="tok-n">getvalue</span><span class="tok-p">()</span>

<span class="tok-nd">@patch.object</span><span class="tok-p">(</span><span class="tok-n">sys</span><span class="tok-p">,</span> <span class="tok-s">'argv'</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s">'dexy'</span><span class="tok-p">,</span> <span class="tok-s">'conf'</span><span class="tok-p">])</span>
<span class="tok-nd">@patch</span><span class="tok-p">(</span><span class="tok-s">'sys.stdout'</span><span class="tok-p">,</span> <span class="tok-n">new_callable</span><span class="tok-o">=</span><span class="tok-n">StringIO</span><span class="tok-p">)</span>
<span class="tok-k">def</span> <span class="tok-nf">test_conf_command_if_path_exists</span><span class="tok-p">(</span><span class="tok-n">stdout</span><span class="tok-p">):</span>
    <span class="tok-k">with</span> <span class="tok-n">tempdir</span><span class="tok-p">():</span>
        <span class="tok-k">with</span> <span class="tok-nb">open</span><span class="tok-p">(</span><span class="tok-s">"dexy.conf"</span><span class="tok-p">,</span> <span class="tok-s">"w"</span><span class="tok-p">)</span> <span class="tok-k">as</span> <span class="tok-n">f</span><span class="tok-p">:</span>
            <span class="tok-n">f</span><span class="tok-o">.</span><span class="tok-n">write</span><span class="tok-p">(</span><span class="tok-s">"foo"</span><span class="tok-p">)</span>
        <span class="tok-k">assert</span> <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">path</span><span class="tok-o">.</span><span class="tok-n">exists</span><span class="tok-p">(</span><span class="tok-s">"dexy.conf"</span><span class="tok-p">)</span>
        <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">commands</span><span class="tok-o">.</span><span class="tok-n">run</span><span class="tok-p">()</span>
        <span class="tok-k">assert</span> <span class="tok-s">"dexy.conf already exists"</span> <span class="tok-ow">in</span> <span class="tok-n">stdout</span><span class="tok-o">.</span><span class="tok-n">getvalue</span><span class="tok-p">()</span>
        <span class="tok-k">assert</span> <span class="tok-s">"artifactsdir"</span> <span class="tok-ow">in</span> <span class="tok-n">stdout</span><span class="tok-o">.</span><span class="tok-n">getvalue</span><span class="tok-p">()</span>

<span class="tok-nd">@patch.object</span><span class="tok-p">(</span><span class="tok-n">sys</span><span class="tok-p">,</span> <span class="tok-s">'argv'</span><span class="tok-p">,</span> <span class="tok-p">[</span><span class="tok-s">'dexy'</span><span class="tok-p">,</span> <span class="tok-s">'conf'</span><span class="tok-p">,</span> <span class="tok-s">'-p'</span><span class="tok-p">])</span>
<span class="tok-nd">@patch</span><span class="tok-p">(</span><span class="tok-s">'sys.stdout'</span><span class="tok-p">,</span> <span class="tok-n">new_callable</span><span class="tok-o">=</span><span class="tok-n">StringIO</span><span class="tok-p">)</span>
<span class="tok-k">def</span> <span class="tok-nf">test_conf_command_with_print_option</span><span class="tok-p">(</span><span class="tok-n">stdout</span><span class="tok-p">):</span>
    <span class="tok-k">with</span> <span class="tok-n">tempdir</span><span class="tok-p">():</span>
        <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">commands</span><span class="tok-o">.</span><span class="tok-n">run</span><span class="tok-p">()</span>
        <span class="tok-k">assert</span> <span class="tok-ow">not</span> <span class="tok-n">os</span><span class="tok-o">.</span><span class="tok-n">path</span><span class="tok-o">.</span><span class="tok-n">exists</span><span class="tok-p">(</span><span class="tok-s">"dexy.conf"</span><span class="tok-p">)</span>
        <span class="tok-k">assert</span> <span class="tok-s">"artifactsdir"</span> <span class="tok-ow">in</span> <span class="tok-n">stdout</span><span class="tok-o">.</span><span class="tok-n">getvalue</span><span class="tok-p">()</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dirs_py">dirs.py</h3>
<div class="paragraph">
<p>These commands expose methods for creating and removing dexy’s working directories.</p>
</div>
<div class="paragraph">
<p>The <code>setup</code> and <code>cleanup</code> command create and remove working directories respectively:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">setup_command</span><span class="tok-p">(</span>
        <span class="tok-n">__cli_options</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">,</span>
        <span class="tok-n">artifactsdir</span><span class="tok-o">=</span><span class="tok-n">defaults</span><span class="tok-p">[</span><span class="tok-s">'artifacts_dir'</span><span class="tok-p">],</span> <span class="tok-c"># Where dexy should store working files.</span>
        <span class="tok-o">**</span><span class="tok-n">kwargs</span><span class="tok-p">):</span>
    <span class="tok-sd">"""</span>
<span class="tok-sd">    Create the directories dexy needs to run.</span>
<span class="tok-sd">    """</span>
    <span class="tok-n">wrapper</span> <span class="tok-o">=</span> <span class="tok-n">init_wrapper</span><span class="tok-p">(</span><span class="tok-nb">locals</span><span class="tok-p">())</span>
    <span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">create_dexy_dirs</span><span class="tok-p">()</span>
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">cleanup_command</span><span class="tok-p">(</span>
        <span class="tok-n">__cli_options</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">,</span>
        <span class="tok-n">artifactsdir</span><span class="tok-o">=</span><span class="tok-n">defaults</span><span class="tok-p">[</span><span class="tok-s">'artifacts_dir'</span><span class="tok-p">],</span> <span class="tok-c"># Where dexy should store working files.</span>
        <span class="tok-n">logdir</span><span class="tok-o">=</span><span class="tok-n">defaults</span><span class="tok-p">[</span><span class="tok-s">'log_dir'</span><span class="tok-p">],</span> <span class="tok-c"># DEPRECATED</span>
        <span class="tok-n">reports</span><span class="tok-o">=</span><span class="tok-bp">True</span> <span class="tok-c"># Whether directories generated by reports should also be removed.</span>
        <span class="tok-p">):</span>
    <span class="tok-sd">"""</span>
<span class="tok-sd">    Remove the directories which dexy created, including working directories</span>
<span class="tok-sd">    and reports.</span>
<span class="tok-sd">    """</span>
    <span class="tok-n">wrapper</span> <span class="tok-o">=</span> <span class="tok-n">init_wrapper</span><span class="tok-p">(</span><span class="tok-nb">locals</span><span class="tok-p">())</span>
    <span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">remove_dexy_dirs</span><span class="tok-p">()</span>
    <span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">remove_reports_dirs</span><span class="tok-p">(</span><span class="tok-n">reports</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>reset</code> command cleans out any working files and leaves you with a fresh setup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">reset_command</span><span class="tok-p">(</span>
        <span class="tok-n">__cli_options</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">,</span>
        <span class="tok-n">artifactsdir</span><span class="tok-o">=</span><span class="tok-n">defaults</span><span class="tok-p">[</span><span class="tok-s">'artifacts_dir'</span><span class="tok-p">],</span> <span class="tok-c"># Where dexy should store working files.</span>
        <span class="tok-n">logdir</span><span class="tok-o">=</span><span class="tok-n">defaults</span><span class="tok-p">[</span><span class="tok-s">'log_dir'</span><span class="tok-p">]</span> <span class="tok-c"># DEPRECATED</span>
        <span class="tok-p">):</span>
    <span class="tok-sd">"""</span>
<span class="tok-sd">    Clean out the contents of dexy's cache and reports directories.</span>
<span class="tok-sd">    """</span>
    <span class="tok-n">wrapper</span> <span class="tok-o">=</span> <span class="tok-n">init_wrapper</span><span class="tok-p">(</span><span class="tok-nb">locals</span><span class="tok-p">())</span>
    <span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">remove_dexy_dirs</span><span class="tok-p">()</span>
    <span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">remove_reports_dirs</span><span class="tok-p">(</span><span class="tok-n">keep_empty_dir</span><span class="tok-o">=</span><span class="tok-bp">True</span><span class="tok-p">)</span>
    <span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">create_dexy_dirs</span><span class="tok-p">()</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fcmds_py">fcmds.py</h3>
<div class="paragraph">
<p>Filter commands are intended to be a way for filters to expose some information
to users. For example, filter commands could provide a way for an API to list
available methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">fcmds_command</span><span class="tok-p">(</span>
        <span class="tok-n">alias</span><span class="tok-o">=</span><span class="tok-bp">False</span> <span class="tok-c"># Only print commands defined by this alias.</span>
        <span class="tok-p">):</span>
    <span class="tok-sd">"""</span>
<span class="tok-sd">    Prints a list of available filter commands.</span>
<span class="tok-sd">    """</span>
    <span class="tok-k">if</span> <span class="tok-n">alias</span><span class="tok-p">:</span>
        <span class="tok-n">filter_instances</span> <span class="tok-o">=</span> <span class="tok-p">[</span><span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">filter</span><span class="tok-o">.</span><span class="tok-n">Filter</span><span class="tok-o">.</span><span class="tok-n">create_instance</span><span class="tok-p">(</span><span class="tok-n">alias</span><span class="tok-p">)]</span>
    <span class="tok-k">else</span><span class="tok-p">:</span>
        <span class="tok-n">filter_instances</span> <span class="tok-o">=</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">filter</span><span class="tok-o">.</span><span class="tok-n">Filter</span>

    <span class="tok-k">for</span> <span class="tok-n">filter_instance</span> <span class="tok-ow">in</span> <span class="tok-n">filter_instances</span><span class="tok-p">:</span>
        <span class="tok-n">cmds</span> <span class="tok-o">=</span> <span class="tok-n">filter_instance</span><span class="tok-o">.</span><span class="tok-n">filter_commands</span><span class="tok-p">()</span>
        <span class="tok-k">if</span> <span class="tok-n">cmds</span><span class="tok-p">:</span>
            <span class="tok-k">print</span> <span class="tok-s">"filter alias:"</span><span class="tok-p">,</span> <span class="tok-n">filter_instance</span><span class="tok-o">.</span><span class="tok-n">alias</span>
            <span class="tok-k">for</span> <span class="tok-n">command_name</span> <span class="tok-ow">in</span> <span class="tok-nb">sorted</span><span class="tok-p">(</span><span class="tok-n">cmds</span><span class="tok-p">):</span>
                <span class="tok-n">docs</span> <span class="tok-o">=</span> <span class="tok-n">inspect</span><span class="tok-o">.</span><span class="tok-n">getdoc</span><span class="tok-p">(</span><span class="tok-n">cmds</span><span class="tok-p">[</span><span class="tok-n">command_name</span><span class="tok-p">])</span>
                <span class="tok-k">if</span> <span class="tok-n">docs</span><span class="tok-p">:</span>
                    <span class="tok-n">doc</span> <span class="tok-o">=</span> <span class="tok-n">docs</span><span class="tok-o">.</span><span class="tok-n">splitlines</span><span class="tok-p">()[</span><span class="tok-mi">0</span><span class="tok-p">]</span>
                    <span class="tok-k">print</span> <span class="tok-s">"    </span><span class="tok-si">%s</span><span class="tok-s">   # </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-n">command_name</span><span class="tok-p">,</span> <span class="tok-n">doc</span><span class="tok-p">)</span>
                <span class="tok-k">else</span><span class="tok-p">:</span>
                    <span class="tok-k">print</span> <span class="tok-s">"    </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">command_name</span>
            <span class="tok-k">print</span> <span class="tok-s">''</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>fcmds_command</code> lists filter commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="console language-console"><span class="tok-gp">$</span> dexy fcmds
<span class="tok-go">filter alias: apis</span>
<span class="tok-go">    create_keyfile</span>

<span class="tok-go">filter alias: botoup</span>
<span class="tok-go">    create_keyfile</span>

<span class="tok-go">filter alias: htmlsections</span>
<span class="tok-go">    css   # Prints out CSS for the specified style.</span>
<span class="tok-go">    sty   # Prints out .sty file (latex) for the specified style.</span>

<span class="tok-go">filter alias: pyg</span>
<span class="tok-go">    css   # Prints out CSS for the specified style.</span>
<span class="tok-go">    sty   # Prints out .sty file (latex) for the specified style.</span>

<span class="tok-go">filter alias: wordpress</span>
<span class="tok-go">    create_keyfile   # Creates a key file for WordPress in the local directory.</span>
<span class="tok-go">    list_categories   # List available blog post categories.</span>
<span class="tok-go">    list_methods   # List API methods exposed by WordPress API.</span>

<span class="tok-gp">$</span> dexy fcmds -alias pyg
<span class="tok-go">filter alias: pyg</span>
<span class="tok-go">    css   # Prints out CSS for the specified style.</span>
<span class="tok-go">    sty   # Prints out .sty file (latex) for the specified style.</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run a filter command you need to pass the alias and the command name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="console language-console"><span class="tok-gp">$</span> dexy fcmd -alias pyg -cmd css | head
<span class="tok-go">.hll { background-color: #ffffcc }</span>
<span class="tok-go">.c { color: #408080; font-style: italic } /* Comment */</span>
<span class="tok-go">.err { border: 1px solid #FF0000 } /* Error */</span>
<span class="tok-go">.k { color: #008000; font-weight: bold } /* Keyword */</span>
<span class="tok-go">.o { color: #666666 } /* Operator */</span>
<span class="tok-go">.cm { color: #408080; font-style: italic } /* Comment.Multiline */</span>
<span class="tok-go">.cp { color: #BC7A00 } /* Comment.Preproc */</span>
<span class="tok-go">.c1 { color: #408080; font-style: italic } /* Comment.Single */</span>
<span class="tok-go">.cs { color: #408080; font-style: italic } /* Comment.Special */</span>
<span class="tok-go">.gd { color: #A00000 } /* Generic.Deleted */</span>
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">fcmd_command</span><span class="tok-p">(</span>
        <span class="tok-n">alias</span><span class="tok-o">=</span><span class="tok-bp">None</span><span class="tok-p">,</span> <span class="tok-c"># The alias of the filter which defines the custom command</span>
        <span class="tok-n">cmd</span><span class="tok-o">=</span><span class="tok-bp">None</span><span class="tok-p">,</span> <span class="tok-c"># The name of the command to run</span>
        <span class="tok-o">**</span><span class="tok-n">kwargs</span> <span class="tok-c"># Additional arguments to be passed to the command</span>
        <span class="tok-p">):</span>
    <span class="tok-sd">"""</span>
<span class="tok-sd">    Run a filter command.</span>
<span class="tok-sd">    """</span>
    <span class="tok-n">filter_instance</span> <span class="tok-o">=</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">filter</span><span class="tok-o">.</span><span class="tok-n">Filter</span><span class="tok-o">.</span><span class="tok-n">create_instance</span><span class="tok-p">(</span><span class="tok-n">alias</span><span class="tok-p">)</span>
    <span class="tok-n">cmd_name</span> <span class="tok-o">=</span> <span class="tok-s">"docmd_</span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">cmd</span>

    <span class="tok-k">if</span> <span class="tok-ow">not</span> <span class="tok-n">cmd_name</span> <span class="tok-ow">in</span> <span class="tok-nb">dir</span><span class="tok-p">(</span><span class="tok-n">filter_instance</span><span class="tok-p">):</span>
        <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"</span><span class="tok-si">%s</span><span class="tok-s"> is not a valid command. There is no method </span><span class="tok-si">%s</span><span class="tok-s"> defined in </span><span class="tok-si">%s</span><span class="tok-s">"</span>
        <span class="tok-n">msgargs</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-n">cmd</span><span class="tok-p">,</span> <span class="tok-n">cmd_name</span><span class="tok-p">,</span> <span class="tok-n">filter_instance</span><span class="tok-o">.</span><span class="tok-n">__class__</span><span class="tok-o">.</span><span class="tok-n">__name__</span><span class="tok-p">)</span>
        <span class="tok-k">raise</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">UserFeedback</span><span class="tok-p">(</span><span class="tok-n">msg</span> <span class="tok-o">%</span> <span class="tok-n">msgargs</span><span class="tok-p">)</span>

    <span class="tok-k">else</span><span class="tok-p">:</span>
        <span class="tok-n">instance_method</span> <span class="tok-o">=</span> <span class="tok-nb">getattr</span><span class="tok-p">(</span><span class="tok-n">filter_instance</span><span class="tok-p">,</span> <span class="tok-n">cmd_name</span><span class="tok-p">)</span>
        <span class="tok-c"># TODO use try/catch instead of inspect.ismethod</span>
        <span class="tok-k">if</span> <span class="tok-n">inspect</span><span class="tok-o">.</span><span class="tok-n">ismethod</span><span class="tok-p">(</span><span class="tok-n">instance_method</span><span class="tok-p">):</span>
            <span class="tok-k">try</span><span class="tok-p">:</span>
                <span class="tok-n">instance_method</span><span class="tok-o">.</span><span class="tok-n">__func__</span><span class="tok-p">(</span><span class="tok-n">filter_instance</span><span class="tok-p">,</span> <span class="tok-o">**</span><span class="tok-n">kwargs</span><span class="tok-p">)</span>
            <span class="tok-k">except</span> <span class="tok-ne">TypeError</span> <span class="tok-k">as</span> <span class="tok-n">e</span><span class="tok-p">:</span>
                <span class="tok-k">print</span> <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-n">message</span>
                <span class="tok-k">print</span> <span class="tok-n">inspect</span><span class="tok-o">.</span><span class="tok-n">getargspec</span><span class="tok-p">(</span><span class="tok-n">instance_method</span><span class="tok-o">.</span><span class="tok-n">__func__</span><span class="tok-p">)</span>
                <span class="tok-k">print</span> <span class="tok-n">inspect</span><span class="tok-o">.</span><span class="tok-n">getdoc</span><span class="tok-p">(</span><span class="tok-n">instance_method</span><span class="tok-o">.</span><span class="tok-n">__func__</span><span class="tok-p">)</span>
                <span class="tok-k">raise</span>

        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"expected </span><span class="tok-si">%s</span><span class="tok-s"> to be an instance method of </span><span class="tok-si">%s</span><span class="tok-s">"</span>
            <span class="tok-n">msgargs</span> <span class="tok-o">=</span> <span class="tok-p">(</span><span class="tok-n">cmd_name</span><span class="tok-p">,</span> <span class="tok-n">filter_instance</span><span class="tok-o">.</span><span class="tok-n">__class__</span><span class="tok-o">.</span><span class="tok-n">__name__</span><span class="tok-p">)</span>
            <span class="tok-k">raise</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">InternalDexyProblem</span><span class="tok-p">(</span><span class="tok-n">msg</span> <span class="tok-o">%</span> <span class="tok-n">msgargs</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_filters_py">filters.py</h3>
<div class="paragraph">
<p>The filters module contains dexy’s command line reference for filters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">filters_command</span><span class="tok-p">(</span>
        <span class="tok-n">alias</span><span class="tok-o">=</span><span class="tok-s">""</span><span class="tok-p">,</span> <span class="tok-c"># Print docs for this filter.</span>
        <span class="tok-n">example</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">,</span> <span class="tok-c"># Whether to run included examples (slower).</span>
        <span class="tok-n">nocolor</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">,</span> <span class="tok-c"># Skip syntax highlighting if showing source code.</span>
        <span class="tok-n">source</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">,</span> <span class="tok-c"># Print source code of filter.</span>
        <span class="tok-n">versions</span><span class="tok-o">=</span><span class="tok-bp">False</span> <span class="tok-c"># Print the installed version of external software (slower).</span>
        <span class="tok-p">):</span>
    <span class="tok-sd">"""</span>
<span class="tok-sd">    Prints list of available filters or docs for a particular filter.</span>
<span class="tok-sd">    """</span>
    <span class="tok-k">if</span> <span class="tok-n">alias</span><span class="tok-p">:</span>
        <span class="tok-n">help_for_filter</span><span class="tok-p">(</span><span class="tok-n">alias</span><span class="tok-p">,</span> <span class="tok-n">example</span><span class="tok-p">,</span> <span class="tok-n">source</span><span class="tok-p">,</span> <span class="tok-n">nocolor</span><span class="tok-p">)</span>
    <span class="tok-k">else</span><span class="tok-p">:</span>
        <span class="tok-n">list_filters</span><span class="tok-p">(</span><span class="tok-n">versions</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">help_for_filter</span><span class="tok-p">(</span><span class="tok-n">alias</span><span class="tok-p">,</span> <span class="tok-n">run_example</span><span class="tok-p">,</span> <span class="tok-n">show_source</span><span class="tok-p">,</span> <span class="tok-n">nocolor</span><span class="tok-p">):</span>
    <span class="tok-n">instance</span> <span class="tok-o">=</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">filter</span><span class="tok-o">.</span><span class="tok-n">Filter</span><span class="tok-o">.</span><span class="tok-n">create_instance</span><span class="tok-p">(</span><span class="tok-n">alias</span><span class="tok-p">)</span>

    <span class="tok-k">print</span> <span class="tok-s">''</span>
    <span class="tok-k">print</span> <span class="tok-n">instance</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'help'</span><span class="tok-p">)</span>

    <span class="tok-k">print</span> <span class="tok-s">''</span>
    <span class="tok-k">print</span> <span class="tok-s">"aliases: </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-s">", "</span><span class="tok-o">.</span><span class="tok-n">join</span><span class="tok-p">(</span><span class="tok-n">instance</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'aliases'</span><span class="tok-p">))</span>
    <span class="tok-k">print</span> <span class="tok-s">"tags: </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-s">", "</span><span class="tok-o">.</span><span class="tok-n">join</span><span class="tok-p">(</span><span class="tok-n">instance</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'tags'</span><span class="tok-p">))</span>
    <span class="tok-k">print</span> <span class="tok-s">''</span>

    <span class="tok-k">print</span> <span class="tok-s">"Converts from file formats:"</span>
    <span class="tok-k">for</span> <span class="tok-n">ext</span> <span class="tok-ow">in</span> <span class="tok-n">instance</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'input-extensions'</span><span class="tok-p">):</span>
        <span class="tok-k">print</span> <span class="tok-s">"   </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">ext</span>
    <span class="tok-k">print</span> <span class="tok-s">''</span>

    <span class="tok-k">print</span> <span class="tok-s">"Converts to file formats:"</span>
    <span class="tok-k">for</span> <span class="tok-n">ext</span> <span class="tok-ow">in</span> <span class="tok-n">instance</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'output-extensions'</span><span class="tok-p">):</span>
        <span class="tok-k">print</span> <span class="tok-s">"   </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">ext</span>
    <span class="tok-k">print</span> <span class="tok-s">''</span>

    <span class="tok-k">print</span><span class="tok-p">(</span><span class="tok-s">'Settings:'</span><span class="tok-p">)</span>
    <span class="tok-k">for</span> <span class="tok-n">k</span> <span class="tok-ow">in</span> <span class="tok-nb">sorted</span><span class="tok-p">(</span><span class="tok-n">instance</span><span class="tok-o">.</span><span class="tok-n">_instance_settings</span><span class="tok-p">):</span>
        <span class="tok-k">if</span> <span class="tok-n">k</span> <span class="tok-ow">in</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">filter</span><span class="tok-o">.</span><span class="tok-n">Filter</span><span class="tok-o">.</span><span class="tok-n">nodoc_settings</span><span class="tok-p">:</span>
            <span class="tok-k">continue</span>
        <span class="tok-k">if</span> <span class="tok-n">k</span> <span class="tok-ow">in</span> <span class="tok-p">(</span><span class="tok-s">'aliases'</span><span class="tok-p">,</span> <span class="tok-s">'tags'</span><span class="tok-p">):</span>
            <span class="tok-k">continue</span>

        <span class="tok-n">tup</span> <span class="tok-o">=</span> <span class="tok-n">instance</span><span class="tok-o">.</span><span class="tok-n">_instance_settings</span><span class="tok-p">[</span><span class="tok-n">k</span><span class="tok-p">]</span>
        <span class="tok-k">print</span> <span class="tok-s">"    </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">k</span>

        <span class="tok-k">for</span> <span class="tok-n">line</span> <span class="tok-ow">in</span> <span class="tok-n">inspect</span><span class="tok-o">.</span><span class="tok-n">cleandoc</span><span class="tok-p">(</span><span class="tok-n">tup</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">])</span><span class="tok-o">.</span><span class="tok-n">splitlines</span><span class="tok-p">():</span>
            <span class="tok-k">print</span> <span class="tok-s">"        </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">line</span>

        <span class="tok-k">print</span> <span class="tok-s">"        default value: </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">tup</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span>
        <span class="tok-k">print</span> <span class="tok-s">''</span>

    <span class="tok-n">examples</span> <span class="tok-o">=</span> <span class="tok-n">instance</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'examples'</span><span class="tok-p">)</span>
    <span class="tok-n">example_templates</span> <span class="tok-o">=</span> <span class="tok-p">{}</span>
    <span class="tok-k">for</span> <span class="tok-n">alias</span> <span class="tok-ow">in</span> <span class="tok-n">examples</span><span class="tok-p">:</span>
        <span class="tok-k">try</span><span class="tok-p">:</span>
            <span class="tok-n">template_instance</span> <span class="tok-o">=</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">template</span><span class="tok-o">.</span><span class="tok-n">Template</span><span class="tok-o">.</span><span class="tok-n">create_instance</span><span class="tok-p">(</span><span class="tok-n">alias</span><span class="tok-p">)</span>
            <span class="tok-n">example_templates</span><span class="tok-p">[</span><span class="tok-n">alias</span><span class="tok-p">]</span> <span class="tok-o">=</span> <span class="tok-n">template_instance</span>
        <span class="tok-k">except</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">InactivePlugin</span><span class="tok-p">:</span>
            <span class="tok-k">pass</span>

    <span class="tok-k">if</span> <span class="tok-n">examples</span><span class="tok-p">:</span>
        <span class="tok-k">print</span> <span class="tok-s">''</span>
        <span class="tok-k">print</span> <span class="tok-s">"Examples for this filter:"</span>
        <span class="tok-k">for</span> <span class="tok-n">alias</span><span class="tok-p">,</span> <span class="tok-n">template</span> <span class="tok-ow">in</span> <span class="tok-n">example_templates</span><span class="tok-o">.</span><span class="tok-n">iteritems</span><span class="tok-p">():</span>
            <span class="tok-k">print</span> <span class="tok-s">''</span>
            <span class="tok-k">print</span> <span class="tok-s">"  </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">alias</span>
            <span class="tok-k">print</span> <span class="tok-s">"            </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">inspect</span><span class="tok-o">.</span><span class="tok-n">getdoc</span><span class="tok-p">(</span><span class="tok-n">template</span><span class="tok-o">.</span><span class="tok-n">__class__</span><span class="tok-p">)</span>

        <span class="tok-k">if</span> <span class="tok-n">run_example</span><span class="tok-p">:</span>
            <span class="tok-k">for</span> <span class="tok-n">alias</span><span class="tok-p">,</span> <span class="tok-n">template</span> <span class="tok-ow">in</span> <span class="tok-n">example_templates</span><span class="tok-o">.</span><span class="tok-n">iteritems</span><span class="tok-p">():</span>
                <span class="tok-k">print</span> <span class="tok-s">''</span>
                <span class="tok-k">print</span> <span class="tok-s">''</span>
                <span class="tok-k">print</span> <span class="tok-s">"Running example: </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">template</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'help'</span><span class="tok-p">)</span>
                <span class="tok-k">print</span> <span class="tok-s">''</span>
                <span class="tok-k">print</span> <span class="tok-s">''</span>
                <span class="tok-k">print</span> <span class="tok-n">template_text</span><span class="tok-p">(</span><span class="tok-n">template</span><span class="tok-p">)</span>

    <span class="tok-k">print</span> <span class="tok-s">''</span>
    <span class="tok-k">print</span> <span class="tok-s">"For online docs see http://dexy.it/ref/filters/</span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">alias</span>
    <span class="tok-k">print</span> <span class="tok-s">''</span>
    <span class="tok-k">print</span> <span class="tok-s">"If you have suggestions or feedback about this filter,"</span>
    <span class="tok-k">print</span> <span class="tok-s">"please contact info@dexy.it"</span>
    <span class="tok-k">print</span> <span class="tok-s">''</span>

    <span class="tok-k">if</span> <span class="tok-n">show_source</span><span class="tok-p">:</span>
        <span class="tok-k">print</span> <span class="tok-s">''</span>
        <span class="tok-n">source_code</span> <span class="tok-o">=</span> <span class="tok-n">inspect</span><span class="tok-o">.</span><span class="tok-n">getsource</span><span class="tok-p">(</span><span class="tok-n">instance</span><span class="tok-o">.</span><span class="tok-n">__class__</span><span class="tok-p">)</span>
        <span class="tok-k">if</span> <span class="tok-n">nocolor</span><span class="tok-p">:</span>
            <span class="tok-k">print</span> <span class="tok-n">source_code</span>
        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-n">formatter</span> <span class="tok-o">=</span> <span class="tok-n">pygments</span><span class="tok-o">.</span><span class="tok-n">formatters</span><span class="tok-o">.</span><span class="tok-n">TerminalFormatter</span><span class="tok-p">()</span>
            <span class="tok-n">lexer</span> <span class="tok-o">=</span> <span class="tok-n">PythonLexer</span><span class="tok-p">()</span>
            <span class="tok-k">print</span> <span class="tok-n">highlight</span><span class="tok-p">(</span><span class="tok-n">source_code</span><span class="tok-p">,</span> <span class="tok-n">lexer</span><span class="tok-p">,</span> <span class="tok-n">formatter</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">list_filters</span><span class="tok-p">(</span><span class="tok-n">versions</span><span class="tok-p">):</span>
        <span class="tok-k">print</span> <span class="tok-s">"Installed filters:"</span>
        <span class="tok-k">for</span> <span class="tok-n">filter_instance</span> <span class="tok-ow">in</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">filter</span><span class="tok-o">.</span><span class="tok-n">Filter</span><span class="tok-p">:</span>
            <span class="tok-c"># Should we show this filter?</span>
            <span class="tok-n">no_aliases</span> <span class="tok-o">=</span> <span class="tok-ow">not</span> <span class="tok-n">filter_instance</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'aliases'</span><span class="tok-p">)</span>
            <span class="tok-n">no_doc</span> <span class="tok-o">=</span> <span class="tok-n">filter_instance</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'nodoc'</span><span class="tok-p">)</span>
            <span class="tok-n">not_dexy</span> <span class="tok-o">=</span> <span class="tok-ow">not</span> <span class="tok-n">filter_instance</span><span class="tok-o">.</span><span class="tok-n">__class__</span><span class="tok-o">.</span><span class="tok-n">__module__</span><span class="tok-o">.</span><span class="tok-n">startswith</span><span class="tok-p">(</span><span class="tok-s">"dexy."</span><span class="tok-p">)</span>
            <span class="tok-n">exclude</span> <span class="tok-o">=</span> <span class="tok-n">filter_instance</span><span class="tok-o">.</span><span class="tok-n">alias</span> <span class="tok-ow">in</span> <span class="tok-n">extra_nodoc_aliseas</span>

            <span class="tok-k">if</span> <span class="tok-n">no_aliases</span> <span class="tok-ow">or</span> <span class="tok-n">no_doc</span> <span class="tok-ow">or</span> <span class="tok-n">not_dexy</span> <span class="tok-ow">or</span> <span class="tok-n">exclude</span><span class="tok-p">:</span>
                <span class="tok-k">continue</span>

            <span class="tok-c"># generate version message</span>
            <span class="tok-k">if</span> <span class="tok-n">versions</span><span class="tok-p">:</span>
                <span class="tok-k">if</span> <span class="tok-nb">hasattr</span><span class="tok-p">(</span><span class="tok-n">filter_instance</span><span class="tok-p">,</span> <span class="tok-s">'version'</span><span class="tok-p">):</span>
                    <span class="tok-n">version</span> <span class="tok-o">=</span> <span class="tok-n">filter_instance</span><span class="tok-o">.</span><span class="tok-n">version</span><span class="tok-p">()</span>
                    <span class="tok-k">if</span> <span class="tok-n">version</span><span class="tok-p">:</span>
                        <span class="tok-n">version_message</span> <span class="tok-o">=</span> <span class="tok-s">"Installed version: </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">version</span>
                    <span class="tok-k">else</span><span class="tok-p">:</span>
                        <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-s">"'</span><span class="tok-si">%s</span><span class="tok-s">' failed, filter may not be available."</span>
                        <span class="tok-n">msgargs</span> <span class="tok-o">=</span> <span class="tok-n">filter_instance</span><span class="tok-o">.</span><span class="tok-n">version_command</span><span class="tok-p">()</span>
                        <span class="tok-n">version_message</span> <span class="tok-o">=</span> <span class="tok-n">msg</span> <span class="tok-o">%</span> <span class="tok-n">msgargs</span>
                <span class="tok-k">else</span><span class="tok-p">:</span>
                    <span class="tok-n">version_message</span> <span class="tok-o">=</span> <span class="tok-s">""</span>


            <span class="tok-n">filter_help</span> <span class="tok-o">=</span> <span class="tok-s">"  "</span> <span class="tok-o">+</span> <span class="tok-n">filter_instance</span><span class="tok-o">.</span><span class="tok-n">alias</span> <span class="tok-o">+</span> \
                    <span class="tok-s">" : "</span> <span class="tok-o">+</span> <span class="tok-n">filter_instance</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'help'</span><span class="tok-p">)</span><span class="tok-o">.</span><span class="tok-n">splitlines</span><span class="tok-p">()[</span><span class="tok-mi">0</span><span class="tok-p">]</span>

            <span class="tok-k">if</span> <span class="tok-n">versions</span> <span class="tok-ow">and</span> <span class="tok-n">version_message</span><span class="tok-p">:</span>
                <span class="tok-n">filter_help</span> <span class="tok-o">+=</span> <span class="tok-s">" </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">version_message</span>

            <span class="tok-k">print</span> <span class="tok-n">filter_help</span>

        <span class="tok-k">print</span> <span class="tok-s">''</span>
        <span class="tok-k">print</span> <span class="tok-s">"For more information about a particular filter,"</span>
        <span class="tok-k">print</span> <span class="tok-s">"use the -alias flag and specify the filter alias."</span>
        <span class="tok-k">print</span> <span class="tok-s">''</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_grep_py">grep.py</h3>
<div class="paragraph">
<p>The grep interface is a way to search on the command line for dexy docs and
keys within docs.  (The dexy viewer plugin presents similar information in a
web-based interface.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">grep_command</span><span class="tok-p">(</span>
        <span class="tok-n">__cli_options</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">,</span> <span class="tok-c"># nodoc</span>
        <span class="tok-n">contents</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">,</span> <span class="tok-c"># print out the contents of each matched file</span>
        <span class="tok-n">expr</span><span class="tok-o">=</span><span class="tok-s">""</span><span class="tok-p">,</span> <span class="tok-c"># An expression partially matching document name.</span>
        <span class="tok-n">key</span><span class="tok-o">=</span><span class="tok-s">""</span><span class="tok-p">,</span> <span class="tok-c"># An exact document key</span>
        <span class="tok-n">keyexpr</span><span class="tok-o">=</span><span class="tok-s">""</span><span class="tok-p">,</span> <span class="tok-c"># Only search for keys matching this expression</span>
        <span class="tok-n">keylimit</span><span class="tok-o">=</span><span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-c"># Maximum number of matching keys to print</span>
        <span class="tok-n">keys</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">,</span> <span class="tok-c"># List keys in documents</span>
        <span class="tok-n">limit</span><span class="tok-o">=</span><span class="tok-mi">10</span><span class="tok-p">,</span> <span class="tok-c"># Maximum number of matching documents to print</span>
        <span class="tok-n">lines</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">,</span> <span class="tok-c"># maximum number of lines of content to print</span>
        <span class="tok-o">**</span><span class="tok-n">kwargs</span>
        <span class="tok-p">):</span>
    <span class="tok-sd">"""</span>
<span class="tok-sd">    Search for documents and sections within documents.</span>

<span class="tok-sd">    Dexy must have already run successfully.</span>

<span class="tok-sd">    You can search for documents based on exact key or inexpect expression. The</span>
<span class="tok-sd">    number of documents returned is controlled by --limit.</span>

<span class="tok-sd">    You can print all keys in found documents by requesting --keys, number of</span>
<span class="tok-sd">    results is controlled by --keylimit.</span>

<span class="tok-sd">    You can search the section names/keys in found documents by passing a</span>
<span class="tok-sd">    --keyexpr</span>

<span class="tok-sd">    You can print contents of documents by requesting --contents, number of</span>
<span class="tok-sd">    lines of content can be controlled by --lines.</span>

<span class="tok-sd">    This does not search contents of documents, just document names and</span>
<span class="tok-sd">    internal section names.</span>
<span class="tok-sd">    """</span>

    <span class="tok-n">artifactsdir</span> <span class="tok-o">=</span> <span class="tok-n">kwargs</span><span class="tok-o">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-s">'artifactsdir'</span><span class="tok-p">,</span> <span class="tok-n">defaults</span><span class="tok-p">[</span><span class="tok-s">'artifacts_dir'</span><span class="tok-p">])</span>
    <span class="tok-n">wrapper</span> <span class="tok-o">=</span> <span class="tok-n">init_wrapper</span><span class="tok-p">(</span><span class="tok-nb">locals</span><span class="tok-p">())</span>
    <span class="tok-n">batch</span> <span class="tok-o">=</span> <span class="tok-n">Batch</span><span class="tok-o">.</span><span class="tok-n">load_most_recent</span><span class="tok-p">(</span><span class="tok-n">wrapper</span><span class="tok-p">)</span>

    <span class="tok-k">if</span> <span class="tok-ow">not</span> <span class="tok-n">batch</span><span class="tok-p">:</span>
        <span class="tok-k">print</span> <span class="tok-s">"you need to run dexy first"</span>
        <span class="tok-n">sys</span><span class="tok-o">.</span><span class="tok-n">exit</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">)</span>
    <span class="tok-k">else</span><span class="tok-p">:</span>
        <span class="tok-k">if</span> <span class="tok-n">expr</span><span class="tok-p">:</span>
            <span class="tok-n">matches</span> <span class="tok-o">=</span> <span class="tok-nb">sorted</span><span class="tok-p">([</span><span class="tok-n">data</span> <span class="tok-k">for</span> <span class="tok-n">data</span> <span class="tok-ow">in</span> <span class="tok-n">batch</span> <span class="tok-k">if</span> <span class="tok-n">expr</span> <span class="tok-ow">in</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">],</span>
                    <span class="tok-n">key</span><span class="tok-o">=</span><span class="tok-n">attrgetter</span><span class="tok-p">(</span><span class="tok-s">'key'</span><span class="tok-p">))</span>
        <span class="tok-k">elif</span> <span class="tok-n">key</span><span class="tok-p">:</span>
            <span class="tok-n">matches</span> <span class="tok-o">=</span> <span class="tok-nb">sorted</span><span class="tok-p">([</span><span class="tok-n">data</span> <span class="tok-k">for</span> <span class="tok-n">data</span> <span class="tok-ow">in</span> <span class="tok-n">batch</span> <span class="tok-k">if</span> <span class="tok-n">key</span> <span class="tok-o">==</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">],</span>
                    <span class="tok-n">key</span><span class="tok-o">=</span><span class="tok-n">attrgetter</span><span class="tok-p">(</span><span class="tok-s">'key'</span><span class="tok-p">))</span>
        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-k">raise</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">UserFeedback</span><span class="tok-p">(</span><span class="tok-s">"Must specify either expr or key"</span><span class="tok-p">)</span>

        <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-nb">len</span><span class="tok-p">(</span><span class="tok-n">matches</span><span class="tok-p">)</span>
        <span class="tok-k">if</span> <span class="tok-n">n</span> <span class="tok-o">&gt;</span> <span class="tok-n">limit</span><span class="tok-p">:</span>
            <span class="tok-k">print</span> <span class="tok-s">"only printing first </span><span class="tok-si">%s</span><span class="tok-s"> of </span><span class="tok-si">%s</span><span class="tok-s"> total matches"</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-n">limit</span><span class="tok-p">,</span> <span class="tok-n">n</span><span class="tok-p">)</span>
            <span class="tok-n">matches</span> <span class="tok-o">=</span> <span class="tok-n">matches</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">:</span><span class="tok-n">limit</span><span class="tok-p">]</span>

        <span class="tok-k">for</span> <span class="tok-n">match</span> <span class="tok-ow">in</span> <span class="tok-n">matches</span><span class="tok-p">:</span>
            <span class="tok-n">print_match</span><span class="tok-p">(</span><span class="tok-n">match</span><span class="tok-p">,</span> <span class="tok-n">keys</span><span class="tok-p">,</span> <span class="tok-n">keyexpr</span><span class="tok-p">,</span> <span class="tok-n">contents</span><span class="tok-p">,</span> <span class="tok-n">keylimit</span><span class="tok-p">,</span> <span class="tok-n">lines</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The grep command calls <code>print_match</code> for each match:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">print_match</span><span class="tok-p">(</span><span class="tok-n">match</span><span class="tok-p">,</span> <span class="tok-n">keys</span><span class="tok-p">,</span> <span class="tok-n">keyexpr</span><span class="tok-p">,</span> <span class="tok-n">contents</span><span class="tok-p">,</span> <span class="tok-n">keylimit</span><span class="tok-p">,</span> <span class="tok-n">lines</span><span class="tok-p">):</span>
    <span class="tok-k">print</span> <span class="tok-n">match</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">,</span> <span class="tok-s">"</span><span class="tok-se">\t</span><span class="tok-s">cache key:"</span><span class="tok-p">,</span> <span class="tok-n">match</span><span class="tok-o">.</span><span class="tok-n">storage_key</span>

    <span class="tok-k">if</span> <span class="tok-nb">hasattr</span><span class="tok-p">(</span><span class="tok-n">match</span><span class="tok-p">,</span> <span class="tok-s">'keys'</span><span class="tok-p">):</span>
        <span class="tok-k">if</span> <span class="tok-n">keyexpr</span><span class="tok-p">:</span>
            <span class="tok-n">print_keys</span><span class="tok-p">([</span><span class="tok-n">key</span> <span class="tok-k">for</span> <span class="tok-n">key</span> <span class="tok-ow">in</span> <span class="tok-n">match</span><span class="tok-o">.</span><span class="tok-n">keys</span><span class="tok-p">()</span> <span class="tok-k">if</span> <span class="tok-n">keyexpr</span> <span class="tok-ow">in</span> <span class="tok-n">key</span><span class="tok-p">],</span> <span class="tok-n">keylimit</span><span class="tok-p">,</span> <span class="tok-n">lines</span><span class="tok-p">)</span>
        <span class="tok-k">elif</span> <span class="tok-n">keys</span><span class="tok-p">:</span>
            <span class="tok-n">print_keys</span><span class="tok-p">(</span><span class="tok-n">match</span><span class="tok-o">.</span><span class="tok-n">keys</span><span class="tok-p">(),</span> <span class="tok-n">keylimit</span><span class="tok-p">,</span> <span class="tok-n">lines</span><span class="tok-p">)</span>

    <span class="tok-k">if</span> <span class="tok-n">contents</span><span class="tok-p">:</span>
        <span class="tok-k">if</span> <span class="tok-nb">isinstance</span><span class="tok-p">(</span><span class="tok-n">match</span><span class="tok-p">,</span> <span class="tok-n">Sectioned</span><span class="tok-p">):</span>
            <span class="tok-k">for</span> <span class="tok-n">section_name</span><span class="tok-p">,</span> <span class="tok-n">section_contents</span> <span class="tok-ow">in</span> <span class="tok-n">match</span><span class="tok-o">.</span><span class="tok-n">data</span><span class="tok-p">()</span><span class="tok-o">.</span><span class="tok-n">iteritems</span><span class="tok-p">():</span>
                <span class="tok-k">print</span> <span class="tok-s">"  section: </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-n">section_name</span>
                <span class="tok-k">print</span>
                <span class="tok-n">print_contents</span><span class="tok-p">(</span><span class="tok-n">section_contents</span><span class="tok-p">,</span> <span class="tok-n">lines</span><span class="tok-p">)</span>
                <span class="tok-k">print</span>
        <span class="tok-k">elif</span> <span class="tok-nb">isinstance</span><span class="tok-p">(</span><span class="tok-n">match</span><span class="tok-p">,</span> <span class="tok-n">KeyValue</span><span class="tok-p">):</span>
            <span class="tok-k">pass</span>
        <span class="tok-k">elif</span> <span class="tok-nb">isinstance</span><span class="tok-p">(</span><span class="tok-n">match</span><span class="tok-p">,</span> <span class="tok-n">Generic</span><span class="tok-p">):</span>
            <span class="tok-k">try</span><span class="tok-p">:</span>
                <span class="tok-n">json</span><span class="tok-o">.</span><span class="tok-n">dumps</span><span class="tok-p">(</span><span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">match</span><span class="tok-p">))</span>
                <span class="tok-n">print_contents</span><span class="tok-p">(</span><span class="tok-nb">unicode</span><span class="tok-p">(</span><span class="tok-n">match</span><span class="tok-p">),</span> <span class="tok-n">lines</span><span class="tok-p">)</span>
            <span class="tok-k">except</span> <span class="tok-ne">UnicodeDecodeError</span><span class="tok-p">:</span>
                <span class="tok-k">print</span> <span class="tok-s">"  not printable"</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where it reaches a document which has keys, it may also print the keys (depending on options):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">print_keys</span><span class="tok-p">(</span><span class="tok-n">pkeys</span><span class="tok-p">,</span> <span class="tok-n">keylimit</span><span class="tok-p">,</span> <span class="tok-n">lines</span><span class="tok-p">):</span>
    <span class="tok-n">n</span> <span class="tok-o">=</span> <span class="tok-nb">len</span><span class="tok-p">(</span><span class="tok-n">pkeys</span><span class="tok-p">)</span>
    <span class="tok-k">if</span> <span class="tok-n">n</span> <span class="tok-o">&gt;</span> <span class="tok-n">keylimit</span><span class="tok-p">:</span>
        <span class="tok-n">pkeys</span> <span class="tok-o">=</span> <span class="tok-n">pkeys</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">:</span><span class="tok-n">keylimit</span><span class="tok-p">]</span>

    <span class="tok-k">for</span> <span class="tok-n">key</span> <span class="tok-ow">in</span> <span class="tok-n">pkeys</span><span class="tok-p">:</span>
        <span class="tok-k">print</span> <span class="tok-s">'  '</span><span class="tok-p">,</span> <span class="tok-n">key</span>

    <span class="tok-k">if</span> <span class="tok-n">n</span> <span class="tok-o">&gt;</span> <span class="tok-n">keylimit</span><span class="tok-p">:</span>
        <span class="tok-k">print</span> <span class="tok-s">"  only printed first </span><span class="tok-si">%s</span><span class="tok-s"> of </span><span class="tok-si">%s</span><span class="tok-s"> total keys"</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-n">keylimit</span><span class="tok-p">,</span> <span class="tok-n">n</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>And contents of files may also be printed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">print_contents</span><span class="tok-p">(</span><span class="tok-n">text</span><span class="tok-p">,</span> <span class="tok-n">lines</span><span class="tok-p">):</span>
    <span class="tok-n">text_lines</span> <span class="tok-o">=</span> <span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-n">splitlines</span><span class="tok-p">()</span>
    <span class="tok-k">for</span> <span class="tok-n">i</span><span class="tok-p">,</span> <span class="tok-n">line</span> <span class="tok-ow">in</span> <span class="tok-nb">enumerate</span><span class="tok-p">(</span><span class="tok-n">text_lines</span><span class="tok-p">):</span>
        <span class="tok-k">if</span> <span class="tok-n">lines</span> <span class="tok-ow">and</span> <span class="tok-n">i</span> <span class="tok-o">&gt;</span> <span class="tok-n">lines</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">:</span>
            <span class="tok-k">continue</span>
        <span class="tok-k">print</span> <span class="tok-s">"  "</span><span class="tok-p">,</span> <span class="tok-n">line</span>

    <span class="tok-k">if</span> <span class="tok-n">lines</span> <span class="tok-ow">and</span> <span class="tok-n">lines</span> <span class="tok-o">&lt;</span> <span class="tok-nb">len</span><span class="tok-p">(</span><span class="tok-n">text_lines</span><span class="tok-p">):</span>
        <span class="tok-k">print</span> <span class="tok-s">"   only printed first </span><span class="tok-si">%s</span><span class="tok-s"> of </span><span class="tok-si">%s</span><span class="tok-s"> total lines"</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-n">lines</span><span class="tok-p">,</span> <span class="tok-nb">len</span><span class="tok-p">(</span><span class="tok-n">text_lines</span><span class="tok-p">))</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_info_py">info.py</h3>
<div class="paragraph">
<p>The info command lets you see where documents are cached and to get
documentation about their available methods. You should know the doc key you
want to search for, you can use <code>dexy grep</code> to help you search.</p>
</div>
<div class="paragraph">
<p>The attributes listed in <code>info_attrs</code> and the methods listed in <code>info_methods</code>
are displayed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-n">info_attrs</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
        <span class="tok-s">'name'</span><span class="tok-p">,</span>
        <span class="tok-s">'ext'</span><span class="tok-p">,</span>
        <span class="tok-s">'key'</span>
        <span class="tok-p">]</span>

<span class="tok-n">info_methods</span> <span class="tok-o">=</span> <span class="tok-p">[</span>
        <span class="tok-s">'title'</span><span class="tok-p">,</span>
        <span class="tok-s">'basename'</span><span class="tok-p">,</span>
        <span class="tok-s">'filesize'</span><span class="tok-p">,</span>
        <span class="tok-s">'baserootname'</span><span class="tok-p">,</span>
        <span class="tok-s">'parent_dir'</span><span class="tok-p">,</span>
        <span class="tok-s">'long_name'</span><span class="tok-p">,</span>
        <span class="tok-s">'web_safe_document_key'</span>
        <span class="tok-p">]</span>

<span class="tok-n">storage_methods</span> <span class="tok-o">=</span> <span class="tok-p">[]</span>
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="python language-python"><span class="tok-k">def</span> <span class="tok-nf">info_command</span><span class="tok-p">(</span>
        <span class="tok-n">__cli_options</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">,</span>
        <span class="tok-n">expr</span><span class="tok-o">=</span><span class="tok-s">""</span><span class="tok-p">,</span> <span class="tok-c"># An expression partially matching document name.</span>
        <span class="tok-n">key</span><span class="tok-o">=</span><span class="tok-s">""</span><span class="tok-p">,</span> <span class="tok-c"># The exact document key.</span>
        <span class="tok-n">ws</span><span class="tok-o">=</span><span class="tok-bp">False</span><span class="tok-p">,</span> <span class="tok-c"># Whether to print website reporter keys and values.</span>
        <span class="tok-o">**</span><span class="tok-n">kwargs</span>
        <span class="tok-p">):</span>
    <span class="tok-sd">"""</span>
<span class="tok-sd">    Prints metadata about a dexy document.</span>

<span class="tok-sd">    Dexy must have already run successfully.</span>

<span class="tok-sd">    You can specify an exact document key or an expression which matches part</span>
<span class="tok-sd">    of a document name/key. The `dexy grep` command is available to help you</span>
<span class="tok-sd">    search for documents and print document contents.</span>
<span class="tok-sd">    """</span>
    <span class="tok-n">artifactsdir</span> <span class="tok-o">=</span> <span class="tok-n">kwargs</span><span class="tok-o">.</span><span class="tok-n">get</span><span class="tok-p">(</span><span class="tok-s">'artifactsdir'</span><span class="tok-p">,</span> <span class="tok-n">defaults</span><span class="tok-p">[</span><span class="tok-s">'artifacts_dir'</span><span class="tok-p">])</span>
    <span class="tok-n">wrapper</span> <span class="tok-o">=</span> <span class="tok-n">init_wrapper</span><span class="tok-p">(</span><span class="tok-nb">locals</span><span class="tok-p">())</span>
    <span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">setup_log</span><span class="tok-p">()</span>
    <span class="tok-n">batch</span> <span class="tok-o">=</span> <span class="tok-n">Batch</span><span class="tok-o">.</span><span class="tok-n">load_most_recent</span><span class="tok-p">(</span><span class="tok-n">wrapper</span><span class="tok-p">)</span>
    <span class="tok-n">wrapper</span><span class="tok-o">.</span><span class="tok-n">batch</span> <span class="tok-o">=</span> <span class="tok-n">batch</span>

    <span class="tok-k">if</span> <span class="tok-n">expr</span><span class="tok-p">:</span>
        <span class="tok-k">print</span> <span class="tok-s">"search expr:"</span><span class="tok-p">,</span> <span class="tok-n">expr</span>
        <span class="tok-n">matches</span> <span class="tok-o">=</span> <span class="tok-nb">sorted</span><span class="tok-p">([</span><span class="tok-n">data</span> <span class="tok-k">for</span> <span class="tok-n">data</span> <span class="tok-ow">in</span> <span class="tok-n">batch</span> <span class="tok-k">if</span> <span class="tok-n">expr</span> <span class="tok-ow">in</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">],</span>
                <span class="tok-n">key</span><span class="tok-o">=</span><span class="tok-n">attrgetter</span><span class="tok-p">(</span><span class="tok-s">'key'</span><span class="tok-p">))</span>
    <span class="tok-k">elif</span> <span class="tok-n">key</span><span class="tok-p">:</span>
        <span class="tok-n">matches</span> <span class="tok-o">=</span> <span class="tok-nb">sorted</span><span class="tok-p">([</span><span class="tok-n">data</span> <span class="tok-k">for</span> <span class="tok-n">data</span> <span class="tok-ow">in</span> <span class="tok-n">batch</span> <span class="tok-k">if</span> <span class="tok-n">key</span> <span class="tok-o">==</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-n">key</span><span class="tok-p">],</span>
                <span class="tok-n">key</span><span class="tok-o">=</span><span class="tok-n">attrgetter</span><span class="tok-p">(</span><span class="tok-s">'key'</span><span class="tok-p">))</span>
    <span class="tok-k">else</span><span class="tok-p">:</span>
        <span class="tok-k">raise</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">exceptions</span><span class="tok-o">.</span><span class="tok-n">UserFeedback</span><span class="tok-p">(</span><span class="tok-s">"Must specify either expr or key"</span><span class="tok-p">)</span>

    <span class="tok-k">for</span> <span class="tok-n">match</span> <span class="tok-ow">in</span> <span class="tok-n">matches</span><span class="tok-p">:</span>
        <span class="tok-k">print</span> <span class="tok-s">""</span>
        <span class="tok-k">print</span> <span class="tok-s">"  Info for Document '</span><span class="tok-si">%s</span><span class="tok-s">'"</span> <span class="tok-o">%</span> <span class="tok-n">match</span><span class="tok-o">.</span><span class="tok-n">key</span>
        <span class="tok-k">print</span> <span class="tok-s">""</span>
        <span class="tok-k">print</span> <span class="tok-s">"  document output data type:"</span><span class="tok-p">,</span> <span class="tok-n">match</span><span class="tok-o">.</span><span class="tok-n">alias</span>
        <span class="tok-k">print</span> <span class="tok-s">""</span>

        <span class="tok-n">print_indented</span><span class="tok-p">(</span><span class="tok-s">"settings:"</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
        <span class="tok-k">for</span> <span class="tok-n">k</span> <span class="tok-ow">in</span> <span class="tok-nb">sorted</span><span class="tok-p">(</span><span class="tok-n">match</span><span class="tok-o">.</span><span class="tok-n">_instance_settings</span><span class="tok-p">):</span>
            <span class="tok-k">if</span> <span class="tok-ow">not</span> <span class="tok-n">k</span> <span class="tok-ow">in</span> <span class="tok-p">(</span><span class="tok-s">'aliases'</span><span class="tok-p">,</span> <span class="tok-s">'help'</span><span class="tok-p">):</span>
                <span class="tok-n">print_indented</span><span class="tok-p">(</span><span class="tok-s">"</span><span class="tok-si">%s</span><span class="tok-s">: </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-n">k</span><span class="tok-p">,</span> <span class="tok-n">match</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-n">k</span><span class="tok-p">)),</span> <span class="tok-mi">4</span><span class="tok-p">)</span>

        <span class="tok-k">print</span> <span class="tok-s">""</span>
        <span class="tok-n">print_indented</span><span class="tok-p">(</span><span class="tok-s">"attributes:"</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
        <span class="tok-k">for</span> <span class="tok-n">fname</span> <span class="tok-ow">in</span> <span class="tok-nb">sorted</span><span class="tok-p">(</span><span class="tok-n">info_attrs</span><span class="tok-p">):</span>
            <span class="tok-n">print_indented</span><span class="tok-p">(</span><span class="tok-s">"</span><span class="tok-si">%s</span><span class="tok-s">: </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-n">fname</span><span class="tok-p">,</span> <span class="tok-nb">getattr</span><span class="tok-p">(</span><span class="tok-n">match</span><span class="tok-p">,</span> <span class="tok-n">fname</span><span class="tok-p">)),</span> <span class="tok-mi">4</span><span class="tok-p">)</span>
        <span class="tok-k">print</span> <span class="tok-s">""</span>

        <span class="tok-n">print_indented</span><span class="tok-p">(</span><span class="tok-s">"methods:"</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
        <span class="tok-k">for</span> <span class="tok-n">fname</span> <span class="tok-ow">in</span> <span class="tok-nb">sorted</span><span class="tok-p">(</span><span class="tok-n">info_methods</span><span class="tok-p">):</span>
            <span class="tok-n">print_indented</span><span class="tok-p">(</span><span class="tok-s">"</span><span class="tok-si">%s</span><span class="tok-s">(): </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-n">fname</span><span class="tok-p">,</span> <span class="tok-nb">getattr</span><span class="tok-p">(</span><span class="tok-n">match</span><span class="tok-p">,</span> <span class="tok-n">fname</span><span class="tok-p">)()),</span> <span class="tok-mi">4</span><span class="tok-p">)</span>
        <span class="tok-k">print</span> <span class="tok-s">""</span>

        <span class="tok-k">if</span> <span class="tok-n">storage_methods</span><span class="tok-p">:</span>
            <span class="tok-n">print_indented</span><span class="tok-p">(</span><span class="tok-s">"storage methods:"</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
            <span class="tok-k">for</span> <span class="tok-n">fname</span> <span class="tok-ow">in</span> <span class="tok-nb">sorted</span><span class="tok-p">(</span><span class="tok-n">storage_methods</span><span class="tok-p">):</span>
                <span class="tok-n">print_indented</span><span class="tok-p">(</span><span class="tok-s">"</span><span class="tok-si">%s</span><span class="tok-s">(): </span><span class="tok-si">%s</span><span class="tok-s">"</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-n">fname</span><span class="tok-p">,</span> <span class="tok-nb">getattr</span><span class="tok-p">(</span><span class="tok-n">match</span><span class="tok-o">.</span><span class="tok-n">storage</span><span class="tok-p">,</span> <span class="tok-n">fname</span><span class="tok-p">)),</span> <span class="tok-mi">4</span><span class="tok-p">)</span>
            <span class="tok-k">print</span> <span class="tok-s">''</span>

        <span class="tok-k">if</span> <span class="tok-n">ws</span><span class="tok-p">:</span>
            <span class="tok-n">print_indented</span><span class="tok-p">(</span><span class="tok-s">"website reporter methods:"</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
            <span class="tok-k">print</span> <span class="tok-s">''</span>
            <span class="tok-n">reporter</span> <span class="tok-o">=</span> <span class="tok-n">dexy</span><span class="tok-o">.</span><span class="tok-n">reporter</span><span class="tok-o">.</span><span class="tok-n">Reporter</span><span class="tok-o">.</span><span class="tok-n">create_instance</span><span class="tok-p">(</span><span class="tok-s">'ws'</span><span class="tok-p">)</span>
            <span class="tok-n">reporter</span><span class="tok-o">.</span><span class="tok-n">wrapper</span> <span class="tok-o">=</span> <span class="tok-n">wrapper</span>
            <span class="tok-n">reporter</span><span class="tok-o">.</span><span class="tok-n">setup_navobj</span><span class="tok-p">()</span>
            <span class="tok-n">reporter</span><span class="tok-o">.</span><span class="tok-n">help</span><span class="tok-p">(</span><span class="tok-n">match</span><span class="tok-p">)</span>
            <span class="tok-k">print</span> <span class="tok-s">''</span>
            <span class="tok-n">print_indented</span><span class="tok-p">(</span><span class="tok-s">"active template plugins are:"</span><span class="tok-p">,</span> <span class="tok-mi">2</span><span class="tok-p">)</span>
            <span class="tok-n">print_indented</span><span class="tok-p">(</span><span class="tok-s">", "</span><span class="tok-o">.</span><span class="tok-n">join</span><span class="tok-p">(</span><span class="tok-n">reporter</span><span class="tok-o">.</span><span class="tok-n">setting</span><span class="tok-p">(</span><span class="tok-s">'plugins'</span><span class="tok-p">)),</span> <span class="tok-mi">4</span><span class="tok-p">)</span>
            <span class="tok-k">print</span> <span class="tok-s">''</span>


        <span class="tok-k">else</span><span class="tok-p">:</span>
            <span class="tok-n">print_indented</span><span class="tok-p">(</span><span class="tok-s">"For website reporter tags, run this command with -ws option"</span><span class="tok-p">,</span> <span class="tok-mi">4</span><span class="tok-p">)</span>
            <span class="tok-k">print</span> <span class="tok-s">''</span>


        <span class="tok-n">print_rewrapped</span><span class="tok-p">(</span><span class="tok-s">"""For more information about methods available on this</span>
<span class="tok-s">        data type run `dexy datas -alias </span><span class="tok-si">%s</span><span class="tok-s">`"""</span> <span class="tok-o">%</span> <span class="tok-n">match</span><span class="tok-o">.</span><span class="tok-n">alias</span><span class="tok-p">)</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_it_py">it.py</h3>
<div class="paragraph">
<p>The main command which actually runs dexy.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2013-11-22 16:51:03 EST
</div>
</div>
</body>
</html>